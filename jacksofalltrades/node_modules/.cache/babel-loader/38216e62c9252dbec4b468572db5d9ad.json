{"ast":null,"code":"import { __assign, __spreadArray, __read, __values, __rest } from './_virtual/_tslib.js';\nimport { isFunction, mapValues, isArray, flatten, toArray, toStateValue, isString, getEventType, toSCXMLEvent, matchesState, path, evaluateGuard, mapContext, pathToStateValue, isBuiltInEvent, partition, updateHistoryValue, toStatePath, mapFilterValues, warn, toStatePaths, nestedPath, normalizeTarget, toGuard, toTransitionConfigArray, isMachine, createInvokeId } from './utils.js';\nimport { SpecialTargets } from './types.js';\nimport { State, stateValuesEqual } from './State.js';\nimport { raise as raise$1, send, start as start$1, stop as stop$1, invoke, update, nullEvent } from './actionTypes.js';\nimport { done, start, toActionObjects, raise, stop, resolveActions, doneInvoke, error, toActionObject, toActivityDefinition, after, send as send$1, cancel, initEvent } from './actions.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { STATE_DELIMITER } from './constants.js';\nimport { getAllStateNodes, getConfiguration, isInFinalState, getTagsFromConfiguration, has, getChildren, getValue, isLeafNode, getAllChildren } from './stateUtils.js';\nimport { createInvocableActor } from './Actor.js';\nimport { toInvokeDefinition } from './invokeUtils.js';\nvar NULL_EVENT = '';\nvar STATE_IDENTIFIER = '#';\nvar WILDCARD = '*';\nvar EMPTY_OBJECT = {};\n\nvar isStateId = function (str) {\n  return str[0] === STATE_IDENTIFIER;\n};\n\nvar createDefaultOptions = function () {\n  return {\n    actions: {},\n    guards: {},\n    services: {},\n    activities: {},\n    delays: {}\n  };\n};\n\nvar validateArrayifiedTransitions = function (stateNode, event, transitions) {\n  var hasNonLastUnguardedTarget = transitions.slice(0, -1).some(function (transition) {\n    return !('cond' in transition) && !('in' in transition) && (isString(transition.target) || isMachine(transition.target));\n  });\n  var eventText = event === NULL_EVENT ? 'the transient event' : \"event '\".concat(event, \"'\");\n  warn(!hasNonLastUnguardedTarget, \"One or more transitions for \".concat(eventText, \" on state '\").concat(stateNode.id, \"' are unreachable. \") + \"Make sure that the default transition is the last one defined.\");\n};\n\nvar StateNode =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  function StateNode(\n  /**\r\n   * The raw config used to create the machine.\r\n   */\n  config, options,\n  /**\r\n   * The initial extended state\r\n   */\n  _context, // TODO: this is unsafe, but we're removing it in v5 anyway\n  _stateInfo) {\n    if (_context === void 0) {\n      _context = 'context' in config ? config.context : undefined;\n    }\n\n    var _this = this;\n\n    var _a;\n\n    this.config = config;\n    this._context = _context;\n    /**\r\n     * The order this state node appears. Corresponds to the implicit SCXML document order.\r\n     */\n\n    this.order = -1;\n    this.__xstatenode = true;\n    this.__cache = {\n      events: undefined,\n      relativeValue: new Map(),\n      initialStateValue: undefined,\n      initialState: undefined,\n      on: undefined,\n      transitions: undefined,\n      candidates: {},\n      delayedTransitions: undefined\n    };\n    this.idMap = {};\n    this.tags = [];\n    this.options = Object.assign(createDefaultOptions(), options);\n    this.parent = _stateInfo === null || _stateInfo === void 0 ? void 0 : _stateInfo.parent;\n    this.key = this.config.key || (_stateInfo === null || _stateInfo === void 0 ? void 0 : _stateInfo.key) || this.config.id || '(machine)';\n    this.machine = this.parent ? this.parent.machine : this;\n    this.path = this.parent ? this.parent.path.concat(this.key) : [];\n    this.delimiter = this.config.delimiter || (this.parent ? this.parent.delimiter : STATE_DELIMITER);\n    this.id = this.config.id || __spreadArray([this.machine.key], __read(this.path), false).join(this.delimiter);\n    this.version = this.parent ? this.parent.version : this.config.version;\n    this.type = this.config.type || (this.config.parallel ? 'parallel' : this.config.states && Object.keys(this.config.states).length ? 'compound' : this.config.history ? 'history' : 'atomic');\n    this.schema = this.parent ? this.machine.schema : (_a = this.config.schema) !== null && _a !== void 0 ? _a : {};\n    this.description = this.config.description;\n\n    if (!IS_PRODUCTION) {\n      warn(!('parallel' in this.config), \"The \\\"parallel\\\" property is deprecated and will be removed in version 4.1. \".concat(this.config.parallel ? \"Replace with `type: 'parallel'`\" : \"Use `type: '\".concat(this.type, \"'`\"), \" in the config for state node '\").concat(this.id, \"' instead.\"));\n    }\n\n    this.initial = this.config.initial;\n    this.states = this.config.states ? mapValues(this.config.states, function (stateConfig, key) {\n      var _a;\n\n      var stateNode = new StateNode(stateConfig, {}, undefined, {\n        parent: _this,\n        key: key\n      });\n      Object.assign(_this.idMap, __assign((_a = {}, _a[stateNode.id] = stateNode, _a), stateNode.idMap));\n      return stateNode;\n    }) : EMPTY_OBJECT; // Document order\n\n    var order = 0;\n\n    function dfs(stateNode) {\n      var e_1, _a;\n\n      stateNode.order = order++;\n\n      try {\n        for (var _b = __values(getAllChildren(stateNode)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var child = _c.value;\n          dfs(child);\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n    }\n\n    dfs(this); // History config\n\n    this.history = this.config.history === true ? 'shallow' : this.config.history || false;\n    this._transient = !!this.config.always || (!this.config.on ? false : Array.isArray(this.config.on) ? this.config.on.some(function (_a) {\n      var event = _a.event;\n      return event === NULL_EVENT;\n    }) : NULL_EVENT in this.config.on);\n    this.strict = !!this.config.strict; // TODO: deprecate (entry)\n\n    this.onEntry = toArray(this.config.entry || this.config.onEntry).map(function (action) {\n      return toActionObject(action);\n    }); // TODO: deprecate (exit)\n\n    this.onExit = toArray(this.config.exit || this.config.onExit).map(function (action) {\n      return toActionObject(action);\n    });\n    this.meta = this.config.meta;\n    this.doneData = this.type === 'final' ? this.config.data : undefined;\n    this.invoke = toArray(this.config.invoke).map(function (invokeConfig, i) {\n      var _a, _b;\n\n      if (isMachine(invokeConfig)) {\n        var invokeId = createInvokeId(_this.id, i);\n        _this.machine.options.services = __assign((_a = {}, _a[invokeId] = invokeConfig, _a), _this.machine.options.services);\n        return toInvokeDefinition({\n          src: invokeId,\n          id: invokeId\n        });\n      } else if (isString(invokeConfig.src)) {\n        var invokeId = invokeConfig.id || createInvokeId(_this.id, i);\n        return toInvokeDefinition(__assign(__assign({}, invokeConfig), {\n          id: invokeId,\n          src: invokeConfig.src\n        }));\n      } else if (isMachine(invokeConfig.src) || isFunction(invokeConfig.src)) {\n        var invokeId = invokeConfig.id || createInvokeId(_this.id, i);\n        _this.machine.options.services = __assign((_b = {}, _b[invokeId] = invokeConfig.src, _b), _this.machine.options.services);\n        return toInvokeDefinition(__assign(__assign({\n          id: invokeId\n        }, invokeConfig), {\n          src: invokeId\n        }));\n      } else {\n        var invokeSource = invokeConfig.src;\n        return toInvokeDefinition(__assign(__assign({\n          id: createInvokeId(_this.id, i)\n        }, invokeConfig), {\n          src: invokeSource\n        }));\n      }\n    });\n    this.activities = toArray(this.config.activities).concat(this.invoke).map(function (activity) {\n      return toActivityDefinition(activity);\n    });\n    this.transition = this.transition.bind(this);\n    this.tags = toArray(this.config.tags); // TODO: this is the real fix for initialization once\n    // state node getters are deprecated\n    // if (!this.parent) {\n    //   this._init();\n    // }\n  }\n\n  StateNode.prototype._init = function () {\n    if (this.__cache.transitions) {\n      return;\n    }\n\n    getAllStateNodes(this).forEach(function (stateNode) {\n      return stateNode.on;\n    });\n  };\n  /**\r\n   * Clones this state machine with custom options and context.\r\n   *\r\n   * @param options Options (actions, guards, activities, services) to recursively merge with the existing options.\r\n   * @param context Custom context (will override predefined context)\r\n   */\n\n\n  StateNode.prototype.withConfig = function (options, context) {\n    var _a = this.options,\n        actions = _a.actions,\n        activities = _a.activities,\n        guards = _a.guards,\n        services = _a.services,\n        delays = _a.delays;\n    return new StateNode(this.config, {\n      actions: __assign(__assign({}, actions), options.actions),\n      activities: __assign(__assign({}, activities), options.activities),\n      guards: __assign(__assign({}, guards), options.guards),\n      services: __assign(__assign({}, services), options.services),\n      delays: __assign(__assign({}, delays), options.delays)\n    }, context !== null && context !== void 0 ? context : this.context);\n  };\n  /**\r\n   * Clones this state machine with custom context.\r\n   *\r\n   * @param context Custom context (will override predefined context, not recursive)\r\n   */\n\n\n  StateNode.prototype.withContext = function (context) {\n    return new StateNode(this.config, this.options, context);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"context\", {\n    get: function () {\n      return isFunction(this._context) ? this._context() : this._context;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"definition\", {\n    /**\r\n     * The well-structured state node definition.\r\n     */\n    get: function () {\n      return {\n        id: this.id,\n        key: this.key,\n        version: this.version,\n        context: this.context,\n        type: this.type,\n        initial: this.initial,\n        history: this.history,\n        states: mapValues(this.states, function (state) {\n          return state.definition;\n        }),\n        on: this.on,\n        transitions: this.transitions,\n        entry: this.onEntry,\n        exit: this.onExit,\n        activities: this.activities || [],\n        meta: this.meta,\n        order: this.order || -1,\n        data: this.doneData,\n        invoke: this.invoke,\n        description: this.description,\n        tags: this.tags\n      };\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateNode.prototype.toJSON = function () {\n    return this.definition;\n  };\n\n  Object.defineProperty(StateNode.prototype, \"on\", {\n    /**\r\n     * The mapping of events to transitions.\r\n     */\n    get: function () {\n      if (this.__cache.on) {\n        return this.__cache.on;\n      }\n\n      var transitions = this.transitions;\n      return this.__cache.on = transitions.reduce(function (map, transition) {\n        map[transition.eventType] = map[transition.eventType] || [];\n        map[transition.eventType].push(transition);\n        return map;\n      }, {});\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"after\", {\n    get: function () {\n      return this.__cache.delayedTransitions || (this.__cache.delayedTransitions = this.getDelayedTransitions(), this.__cache.delayedTransitions);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"transitions\", {\n    /**\r\n     * All the transitions that can be taken from this state node.\r\n     */\n    get: function () {\n      return this.__cache.transitions || (this.__cache.transitions = this.formatTransitions(), this.__cache.transitions);\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateNode.prototype.getCandidates = function (eventName) {\n    if (this.__cache.candidates[eventName]) {\n      return this.__cache.candidates[eventName];\n    }\n\n    var transient = eventName === NULL_EVENT;\n    var candidates = this.transitions.filter(function (transition) {\n      var sameEventType = transition.eventType === eventName; // null events should only match against eventless transitions\n\n      return transient ? sameEventType : sameEventType || transition.eventType === WILDCARD;\n    });\n    this.__cache.candidates[eventName] = candidates;\n    return candidates;\n  };\n  /**\r\n   * All delayed transitions from the config.\r\n   */\n\n\n  StateNode.prototype.getDelayedTransitions = function () {\n    var _this = this;\n\n    var afterConfig = this.config.after;\n\n    if (!afterConfig) {\n      return [];\n    }\n\n    var mutateEntryExit = function (delay, i) {\n      var delayRef = isFunction(delay) ? \"\".concat(_this.id, \":delay[\").concat(i, \"]\") : delay;\n      var eventType = after(delayRef, _this.id);\n\n      _this.onEntry.push(send$1(eventType, {\n        delay: delay\n      }));\n\n      _this.onExit.push(cancel(eventType));\n\n      return eventType;\n    };\n\n    var delayedTransitions = isArray(afterConfig) ? afterConfig.map(function (transition, i) {\n      var eventType = mutateEntryExit(transition.delay, i);\n      return __assign(__assign({}, transition), {\n        event: eventType\n      });\n    }) : flatten(Object.keys(afterConfig).map(function (delay, i) {\n      var configTransition = afterConfig[delay];\n      var resolvedTransition = isString(configTransition) ? {\n        target: configTransition\n      } : configTransition;\n      var resolvedDelay = !isNaN(+delay) ? +delay : delay;\n      var eventType = mutateEntryExit(resolvedDelay, i);\n      return toArray(resolvedTransition).map(function (transition) {\n        return __assign(__assign({}, transition), {\n          event: eventType,\n          delay: resolvedDelay\n        });\n      });\n    }));\n    return delayedTransitions.map(function (delayedTransition) {\n      var delay = delayedTransition.delay;\n      return __assign(__assign({}, _this.formatTransition(delayedTransition)), {\n        delay: delay\n      });\n    });\n  };\n  /**\r\n   * Returns the state nodes represented by the current state value.\r\n   *\r\n   * @param state The state value or State instance\r\n   */\n\n\n  StateNode.prototype.getStateNodes = function (state) {\n    var _a;\n\n    var _this = this;\n\n    if (!state) {\n      return [];\n    }\n\n    var stateValue = state instanceof State ? state.value : toStateValue(state, this.delimiter);\n\n    if (isString(stateValue)) {\n      var initialStateValue = this.getStateNode(stateValue).initial;\n      return initialStateValue !== undefined ? this.getStateNodes((_a = {}, _a[stateValue] = initialStateValue, _a)) : [this, this.states[stateValue]];\n    }\n\n    var subStateKeys = Object.keys(stateValue);\n    var subStateNodes = [this];\n    subStateNodes.push.apply(subStateNodes, __spreadArray([], __read(flatten(subStateKeys.map(function (subStateKey) {\n      return _this.getStateNode(subStateKey).getStateNodes(stateValue[subStateKey]);\n    }))), false));\n    return subStateNodes;\n  };\n  /**\r\n   * Returns `true` if this state node explicitly handles the given event.\r\n   *\r\n   * @param event The event in question\r\n   */\n\n\n  StateNode.prototype.handles = function (event) {\n    var eventType = getEventType(event);\n    return this.events.includes(eventType);\n  };\n  /**\r\n   * Resolves the given `state` to a new `State` instance relative to this machine.\r\n   *\r\n   * This ensures that `.events` and `.nextEvents` represent the correct values.\r\n   *\r\n   * @param state The state to resolve\r\n   */\n\n\n  StateNode.prototype.resolveState = function (state) {\n    var stateFromConfig = state instanceof State ? state : State.create(state);\n    var configuration = Array.from(getConfiguration([], this.getStateNodes(stateFromConfig.value)));\n    return new State(__assign(__assign({}, stateFromConfig), {\n      value: this.resolve(stateFromConfig.value),\n      configuration: configuration,\n      done: isInFinalState(configuration, this),\n      tags: getTagsFromConfiguration(configuration),\n      machine: this.machine\n    }));\n  };\n\n  StateNode.prototype.transitionLeafNode = function (stateValue, state, _event) {\n    var stateNode = this.getStateNode(stateValue);\n    var next = stateNode.next(state, _event);\n\n    if (!next || !next.transitions.length) {\n      return this.next(state, _event);\n    }\n\n    return next;\n  };\n\n  StateNode.prototype.transitionCompoundNode = function (stateValue, state, _event) {\n    var subStateKeys = Object.keys(stateValue);\n    var stateNode = this.getStateNode(subStateKeys[0]);\n\n    var next = stateNode._transition(stateValue[subStateKeys[0]], state, _event);\n\n    if (!next || !next.transitions.length) {\n      return this.next(state, _event);\n    }\n\n    return next;\n  };\n\n  StateNode.prototype.transitionParallelNode = function (stateValue, state, _event) {\n    var e_2, _a;\n\n    var transitionMap = {};\n\n    try {\n      for (var _b = __values(Object.keys(stateValue)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var subStateKey = _c.value;\n        var subStateValue = stateValue[subStateKey];\n\n        if (!subStateValue) {\n          continue;\n        }\n\n        var subStateNode = this.getStateNode(subStateKey);\n\n        var next = subStateNode._transition(subStateValue, state, _event);\n\n        if (next) {\n          transitionMap[subStateKey] = next;\n        }\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    var stateTransitions = Object.keys(transitionMap).map(function (key) {\n      return transitionMap[key];\n    });\n    var enabledTransitions = flatten(stateTransitions.map(function (st) {\n      return st.transitions;\n    }));\n    var willTransition = stateTransitions.some(function (st) {\n      return st.transitions.length > 0;\n    });\n\n    if (!willTransition) {\n      return this.next(state, _event);\n    }\n\n    var entryNodes = flatten(stateTransitions.map(function (t) {\n      return t.entrySet;\n    }));\n    var configuration = flatten(Object.keys(transitionMap).map(function (key) {\n      return transitionMap[key].configuration;\n    }));\n    return {\n      transitions: enabledTransitions,\n      entrySet: entryNodes,\n      exitSet: flatten(stateTransitions.map(function (t) {\n        return t.exitSet;\n      })),\n      configuration: configuration,\n      source: state,\n      actions: flatten(Object.keys(transitionMap).map(function (key) {\n        return transitionMap[key].actions;\n      }))\n    };\n  };\n\n  StateNode.prototype._transition = function (stateValue, state, _event) {\n    // leaf node\n    if (isString(stateValue)) {\n      return this.transitionLeafNode(stateValue, state, _event);\n    } // hierarchical node\n\n\n    if (Object.keys(stateValue).length === 1) {\n      return this.transitionCompoundNode(stateValue, state, _event);\n    } // orthogonal node\n\n\n    return this.transitionParallelNode(stateValue, state, _event);\n  };\n\n  StateNode.prototype.getTransitionData = function (state, event) {\n    return this._transition(state.value, state, toSCXMLEvent(event));\n  };\n\n  StateNode.prototype.next = function (state, _event) {\n    var e_3, _a;\n\n    var _this = this;\n\n    var eventName = _event.name;\n    var actions = [];\n    var nextStateNodes = [];\n    var selectedTransition;\n\n    try {\n      for (var _b = __values(this.getCandidates(eventName)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var candidate = _c.value;\n        var cond = candidate.cond,\n            stateIn = candidate.in;\n        var resolvedContext = state.context;\n        var isInState = stateIn ? isString(stateIn) && isStateId(stateIn) ? // Check if in state by ID\n        state.matches(toStateValue(this.getStateNodeById(stateIn).path, this.delimiter)) : // Check if in state by relative grandparent\n        matchesState(toStateValue(stateIn, this.delimiter), path(this.path.slice(0, -2))(state.value)) : true;\n        var guardPassed = false;\n\n        try {\n          guardPassed = !cond || evaluateGuard(this.machine, cond, resolvedContext, _event, state);\n        } catch (err) {\n          throw new Error(\"Unable to evaluate guard '\".concat(cond.name || cond.type, \"' in transition for event '\").concat(eventName, \"' in state node '\").concat(this.id, \"':\\n\").concat(err.message));\n        }\n\n        if (guardPassed && isInState) {\n          if (candidate.target !== undefined) {\n            nextStateNodes = candidate.target;\n          }\n\n          actions.push.apply(actions, __spreadArray([], __read(candidate.actions), false));\n          selectedTransition = candidate;\n          break;\n        }\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    if (!selectedTransition) {\n      return undefined;\n    }\n\n    if (!nextStateNodes.length) {\n      return {\n        transitions: [selectedTransition],\n        entrySet: [],\n        exitSet: [],\n        configuration: state.value ? [this] : [],\n        source: state,\n        actions: actions\n      };\n    }\n\n    var allNextStateNodes = flatten(nextStateNodes.map(function (stateNode) {\n      return _this.getRelativeStateNodes(stateNode, state.historyValue);\n    }));\n    var isInternal = !!selectedTransition.internal;\n    var reentryNodes = [];\n\n    if (!isInternal) {\n      nextStateNodes.forEach(function (targetNode) {\n        reentryNodes.push.apply(reentryNodes, __spreadArray([], __read(_this.getExternalReentryNodes(targetNode)), false));\n      });\n    }\n\n    return {\n      transitions: [selectedTransition],\n      entrySet: reentryNodes,\n      exitSet: isInternal ? [] : [this],\n      configuration: allNextStateNodes,\n      source: state,\n      actions: actions\n    };\n  };\n\n  StateNode.prototype.getExternalReentryNodes = function (targetNode) {\n    var nodes = [];\n\n    var _a = __read(targetNode.order > this.order ? [targetNode, this] : [this, targetNode], 2),\n        marker = _a[0],\n        possibleAncestor = _a[1];\n\n    while (marker && marker !== possibleAncestor) {\n      nodes.push(marker);\n      marker = marker.parent;\n    }\n\n    if (marker !== possibleAncestor) {\n      // we never got to `possibleAncestor`, therefore the initial `marker` \"escapes\" it\n      // it's in a different part of the tree so no states will be reentered for such an external transition\n      return [];\n    }\n\n    nodes.push(possibleAncestor);\n    return nodes;\n  };\n\n  StateNode.prototype.getActions = function (resolvedConfig, isDone, transition, currentContext, _event, prevState, predictableExec) {\n    var e_4, _a, e_5, _b;\n\n    var _this = this;\n\n    var prevConfig = getConfiguration([], prevState ? this.getStateNodes(prevState.value) : [this]);\n\n    try {\n      for (var resolvedConfig_1 = __values(resolvedConfig), resolvedConfig_1_1 = resolvedConfig_1.next(); !resolvedConfig_1_1.done; resolvedConfig_1_1 = resolvedConfig_1.next()) {\n        var sn = resolvedConfig_1_1.value;\n\n        if (!has(prevConfig, sn) || has(transition.entrySet, sn.parent)) {\n          transition.entrySet.push(sn);\n        }\n      }\n    } catch (e_4_1) {\n      e_4 = {\n        error: e_4_1\n      };\n    } finally {\n      try {\n        if (resolvedConfig_1_1 && !resolvedConfig_1_1.done && (_a = resolvedConfig_1.return)) _a.call(resolvedConfig_1);\n      } finally {\n        if (e_4) throw e_4.error;\n      }\n    }\n\n    try {\n      for (var prevConfig_1 = __values(prevConfig), prevConfig_1_1 = prevConfig_1.next(); !prevConfig_1_1.done; prevConfig_1_1 = prevConfig_1.next()) {\n        var sn = prevConfig_1_1.value;\n\n        if (!has(resolvedConfig, sn) || has(transition.exitSet, sn.parent)) {\n          transition.exitSet.push(sn);\n        }\n      }\n    } catch (e_5_1) {\n      e_5 = {\n        error: e_5_1\n      };\n    } finally {\n      try {\n        if (prevConfig_1_1 && !prevConfig_1_1.done && (_b = prevConfig_1.return)) _b.call(prevConfig_1);\n      } finally {\n        if (e_5) throw e_5.error;\n      }\n    }\n\n    var doneEvents = flatten(transition.entrySet.map(function (sn) {\n      var events = [];\n\n      if (sn.type !== 'final') {\n        return events;\n      }\n\n      var parent = sn.parent;\n\n      if (!parent.parent) {\n        return events;\n      }\n\n      events.push(done(sn.id, sn.doneData), // TODO: deprecate - final states should not emit done events for their own state.\n      done(parent.id, sn.doneData ? mapContext(sn.doneData, currentContext, _event) : undefined));\n      var grandparent = parent.parent;\n\n      if (grandparent.type === 'parallel') {\n        if (getChildren(grandparent).every(function (parentNode) {\n          return isInFinalState(transition.configuration, parentNode);\n        })) {\n          events.push(done(grandparent.id));\n        }\n      }\n\n      return events;\n    }));\n    transition.exitSet.sort(function (a, b) {\n      return b.order - a.order;\n    });\n    transition.entrySet.sort(function (a, b) {\n      return a.order - b.order;\n    });\n    var entryStates = new Set(transition.entrySet);\n    var exitStates = new Set(transition.exitSet);\n    var entryActions = Array.from(entryStates).map(function (stateNode) {\n      var entryActions = stateNode.onEntry;\n      var invokeActions = stateNode.activities.map(function (activity) {\n        return start(activity);\n      });\n      return toActionObjects(predictableExec ? __spreadArray(__spreadArray([], __read(entryActions), false), __read(invokeActions), false) : __spreadArray(__spreadArray([], __read(invokeActions), false), __read(entryActions), false), _this.machine.options.actions);\n    }).concat([doneEvents.map(raise)]);\n    var exitActions = Array.from(exitStates).map(function (stateNode) {\n      return toActionObjects(__spreadArray(__spreadArray([], __read(stateNode.onExit), false), __read(stateNode.activities.map(function (activity) {\n        return stop(activity);\n      })), false), _this.machine.options.actions);\n    });\n    var actions = exitActions.concat([toActionObjects(transition.actions, this.machine.options.actions)]).concat(entryActions);\n\n    if (isDone) {\n      var stopActions = toActionObjects(flatten(__spreadArray([], __read(resolvedConfig), false).sort(function (a, b) {\n        return b.order - a.order;\n      }).map(function (stateNode) {\n        return stateNode.onExit;\n      })), this.machine.options.actions).filter(function (action) {\n        return action.type !== raise$1 && (action.type !== send || !!action.to && action.to !== SpecialTargets.Internal);\n      });\n      return actions.concat([stopActions]);\n    }\n\n    return actions;\n  };\n  /**\r\n   * Determines the next state given the current `state` and sent `event`.\r\n   *\r\n   * @param state The current State instance or state value\r\n   * @param event The event that was sent at the current state\r\n   * @param context The current context (extended state) of the current state\r\n   */\n\n\n  StateNode.prototype.transition = function (state, event, context, exec) {\n    if (state === void 0) {\n      state = this.initialState;\n    }\n\n    var _event = toSCXMLEvent(event);\n\n    var currentState;\n\n    if (state instanceof State) {\n      currentState = context === undefined ? state : this.resolveState(State.from(state, context));\n    } else {\n      var resolvedStateValue = isString(state) ? this.resolve(pathToStateValue(this.getResolvedPath(state))) : this.resolve(state);\n      var resolvedContext = context !== null && context !== void 0 ? context : this.machine.context;\n      currentState = this.resolveState(State.from(resolvedStateValue, resolvedContext));\n    }\n\n    if (!IS_PRODUCTION && _event.name === WILDCARD) {\n      throw new Error(\"An event cannot have the wildcard type ('\".concat(WILDCARD, \"')\"));\n    }\n\n    if (this.strict) {\n      if (!this.events.includes(_event.name) && !isBuiltInEvent(_event.name)) {\n        throw new Error(\"Machine '\".concat(this.id, \"' does not accept event '\").concat(_event.name, \"'\"));\n      }\n    }\n\n    var stateTransition = this._transition(currentState.value, currentState, _event) || {\n      transitions: [],\n      configuration: [],\n      entrySet: [],\n      exitSet: [],\n      source: currentState,\n      actions: []\n    };\n    var prevConfig = getConfiguration([], this.getStateNodes(currentState.value));\n    var resolvedConfig = stateTransition.configuration.length ? getConfiguration(prevConfig, stateTransition.configuration) : prevConfig;\n    stateTransition.configuration = __spreadArray([], __read(resolvedConfig), false);\n    return this.resolveTransition(stateTransition, currentState, currentState.context, exec, _event);\n  };\n\n  StateNode.prototype.resolveRaisedTransition = function (state, _event, originalEvent, predictableExec) {\n    var _a;\n\n    var currentActions = state.actions;\n    state = this.transition(state, _event, undefined, predictableExec); // Save original event to state\n    // TODO: this should be the raised event! Delete in V5 (breaking)\n\n    state._event = originalEvent;\n    state.event = originalEvent.data;\n\n    (_a = state.actions).unshift.apply(_a, __spreadArray([], __read(currentActions), false));\n\n    return state;\n  };\n\n  StateNode.prototype.resolveTransition = function (stateTransition, currentState, context, predictableExec, _event) {\n    var e_6, _a, e_7, _b;\n\n    var _this = this;\n\n    if (_event === void 0) {\n      _event = initEvent;\n    }\n\n    var configuration = stateTransition.configuration; // Transition will \"apply\" if:\n    // - this is the initial state (there is no current state)\n    // - OR there are transitions\n\n    var willTransition = !currentState || stateTransition.transitions.length > 0;\n    var resolvedConfiguration = willTransition ? stateTransition.configuration : currentState ? currentState.configuration : [];\n    var isDone = isInFinalState(resolvedConfiguration, this);\n    var resolvedStateValue = willTransition ? getValue(this.machine, configuration) : undefined;\n    var historyValue = currentState ? currentState.historyValue ? currentState.historyValue : stateTransition.source ? this.machine.historyValue(currentState.value) : undefined : undefined;\n    var actionBlocks = this.getActions(new Set(resolvedConfiguration), isDone, stateTransition, context, _event, currentState, predictableExec);\n    var activities = currentState ? __assign({}, currentState.activities) : {};\n\n    try {\n      for (var actionBlocks_1 = __values(actionBlocks), actionBlocks_1_1 = actionBlocks_1.next(); !actionBlocks_1_1.done; actionBlocks_1_1 = actionBlocks_1.next()) {\n        var block = actionBlocks_1_1.value;\n\n        try {\n          for (var block_1 = (e_7 = void 0, __values(block)), block_1_1 = block_1.next(); !block_1_1.done; block_1_1 = block_1.next()) {\n            var action = block_1_1.value;\n\n            if (action.type === start$1) {\n              activities[action.activity.id || action.activity.type] = action;\n            } else if (action.type === stop$1) {\n              activities[action.activity.id || action.activity.type] = false;\n            }\n          }\n        } catch (e_7_1) {\n          e_7 = {\n            error: e_7_1\n          };\n        } finally {\n          try {\n            if (block_1_1 && !block_1_1.done && (_b = block_1.return)) _b.call(block_1);\n          } finally {\n            if (e_7) throw e_7.error;\n          }\n        }\n      }\n    } catch (e_6_1) {\n      e_6 = {\n        error: e_6_1\n      };\n    } finally {\n      try {\n        if (actionBlocks_1_1 && !actionBlocks_1_1.done && (_a = actionBlocks_1.return)) _a.call(actionBlocks_1);\n      } finally {\n        if (e_6) throw e_6.error;\n      }\n    }\n\n    var _c = __read(resolveActions(this, currentState, context, _event, actionBlocks, predictableExec, this.machine.config.predictableActionArguments || this.machine.config.preserveActionOrder), 2),\n        resolvedActions = _c[0],\n        updatedContext = _c[1];\n\n    var _d = __read(partition(resolvedActions, function (action) {\n      return action.type === raise$1 || action.type === send && action.to === SpecialTargets.Internal;\n    }), 2),\n        raisedEvents = _d[0],\n        nonRaisedActions = _d[1];\n\n    var invokeActions = resolvedActions.filter(function (action) {\n      var _a;\n\n      return action.type === start$1 && ((_a = action.activity) === null || _a === void 0 ? void 0 : _a.type) === invoke;\n    });\n    var children = invokeActions.reduce(function (acc, action) {\n      acc[action.activity.id] = createInvocableActor(action.activity, _this.machine, updatedContext, _event);\n      return acc;\n    }, currentState ? __assign({}, currentState.children) : {});\n    var nextState = new State({\n      value: resolvedStateValue || currentState.value,\n      context: updatedContext,\n      _event: _event,\n      // Persist _sessionid between states\n      _sessionid: currentState ? currentState._sessionid : null,\n      historyValue: resolvedStateValue ? historyValue ? updateHistoryValue(historyValue, resolvedStateValue) : undefined : currentState ? currentState.historyValue : undefined,\n      history: !resolvedStateValue || stateTransition.source ? currentState : undefined,\n      actions: resolvedStateValue ? nonRaisedActions : [],\n      activities: resolvedStateValue ? activities : currentState ? currentState.activities : {},\n      events: [],\n      configuration: resolvedConfiguration,\n      transitions: stateTransition.transitions,\n      children: children,\n      done: isDone,\n      tags: getTagsFromConfiguration(resolvedConfiguration),\n      machine: this\n    });\n    var didUpdateContext = context !== updatedContext;\n    nextState.changed = _event.name === update || didUpdateContext; // Dispose of penultimate histories to prevent memory leaks\n\n    var history = nextState.history;\n\n    if (history) {\n      delete history.history;\n    } // There are transient transitions if the machine is not in a final state\n    // and if some of the state nodes have transient (\"always\") transitions.\n\n\n    var hasAlwaysTransitions = !isDone && (this._transient || configuration.some(function (stateNode) {\n      return stateNode._transient;\n    })); // If there are no enabled transitions, check if there are transient transitions.\n    // If there are transient transitions, continue checking for more transitions\n    // because an transient transition should be triggered even if there are no\n    // enabled transitions.\n    //\n    // If we're already working on an transient transition then stop to prevent an infinite loop.\n    //\n    // Otherwise, if there are no enabled nor transient transitions, we are done.\n\n    if (!willTransition && (!hasAlwaysTransitions || _event.name === NULL_EVENT)) {\n      return nextState;\n    }\n\n    var maybeNextState = nextState;\n\n    if (!isDone) {\n      if (hasAlwaysTransitions) {\n        maybeNextState = this.resolveRaisedTransition(maybeNextState, {\n          type: nullEvent\n        }, _event, predictableExec);\n      }\n\n      while (raisedEvents.length) {\n        var raisedEvent = raisedEvents.shift();\n        maybeNextState = this.resolveRaisedTransition(maybeNextState, raisedEvent._event, _event, predictableExec);\n      }\n    } // Detect if state changed\n\n\n    var changed = maybeNextState.changed || (history ? !!maybeNextState.actions.length || didUpdateContext || typeof history.value !== typeof maybeNextState.value || !stateValuesEqual(maybeNextState.value, history.value) : undefined);\n    maybeNextState.changed = changed; // Preserve original history after raised events\n\n    maybeNextState.history = history;\n    return maybeNextState;\n  };\n  /**\r\n   * Returns the child state node from its relative `stateKey`, or throws.\r\n   */\n\n\n  StateNode.prototype.getStateNode = function (stateKey) {\n    if (isStateId(stateKey)) {\n      return this.machine.getStateNodeById(stateKey);\n    }\n\n    if (!this.states) {\n      throw new Error(\"Unable to retrieve child state '\".concat(stateKey, \"' from '\").concat(this.id, \"'; no child states exist.\"));\n    }\n\n    var result = this.states[stateKey];\n\n    if (!result) {\n      throw new Error(\"Child state '\".concat(stateKey, \"' does not exist on '\").concat(this.id, \"'\"));\n    }\n\n    return result;\n  };\n  /**\r\n   * Returns the state node with the given `stateId`, or throws.\r\n   *\r\n   * @param stateId The state ID. The prefix \"#\" is removed.\r\n   */\n\n\n  StateNode.prototype.getStateNodeById = function (stateId) {\n    var resolvedStateId = isStateId(stateId) ? stateId.slice(STATE_IDENTIFIER.length) : stateId;\n\n    if (resolvedStateId === this.id) {\n      return this;\n    }\n\n    var stateNode = this.machine.idMap[resolvedStateId];\n\n    if (!stateNode) {\n      throw new Error(\"Child state node '#\".concat(resolvedStateId, \"' does not exist on machine '\").concat(this.id, \"'\"));\n    }\n\n    return stateNode;\n  };\n  /**\r\n   * Returns the relative state node from the given `statePath`, or throws.\r\n   *\r\n   * @param statePath The string or string array relative path to the state node.\r\n   */\n\n\n  StateNode.prototype.getStateNodeByPath = function (statePath) {\n    if (typeof statePath === 'string' && isStateId(statePath)) {\n      try {\n        return this.getStateNodeById(statePath.slice(1));\n      } catch (e) {// try individual paths\n        // throw e;\n      }\n    }\n\n    var arrayStatePath = toStatePath(statePath, this.delimiter).slice();\n    var currentStateNode = this;\n\n    while (arrayStatePath.length) {\n      var key = arrayStatePath.shift();\n\n      if (!key.length) {\n        break;\n      }\n\n      currentStateNode = currentStateNode.getStateNode(key);\n    }\n\n    return currentStateNode;\n  };\n  /**\r\n   * Resolves a partial state value with its full representation in this machine.\r\n   *\r\n   * @param stateValue The partial state value to resolve.\r\n   */\n\n\n  StateNode.prototype.resolve = function (stateValue) {\n    var _a;\n\n    var _this = this;\n\n    if (!stateValue) {\n      return this.initialStateValue || EMPTY_OBJECT; // TODO: type-specific properties\n    }\n\n    switch (this.type) {\n      case 'parallel':\n        return mapValues(this.initialStateValue, function (subStateValue, subStateKey) {\n          return subStateValue ? _this.getStateNode(subStateKey).resolve(stateValue[subStateKey] || subStateValue) : EMPTY_OBJECT;\n        });\n\n      case 'compound':\n        if (isString(stateValue)) {\n          var subStateNode = this.getStateNode(stateValue);\n\n          if (subStateNode.type === 'parallel' || subStateNode.type === 'compound') {\n            return _a = {}, _a[stateValue] = subStateNode.initialStateValue, _a;\n          }\n\n          return stateValue;\n        }\n\n        if (!Object.keys(stateValue).length) {\n          return this.initialStateValue || {};\n        }\n\n        return mapValues(stateValue, function (subStateValue, subStateKey) {\n          return subStateValue ? _this.getStateNode(subStateKey).resolve(subStateValue) : EMPTY_OBJECT;\n        });\n\n      default:\n        return stateValue || EMPTY_OBJECT;\n    }\n  };\n\n  StateNode.prototype.getResolvedPath = function (stateIdentifier) {\n    if (isStateId(stateIdentifier)) {\n      var stateNode = this.machine.idMap[stateIdentifier.slice(STATE_IDENTIFIER.length)];\n\n      if (!stateNode) {\n        throw new Error(\"Unable to find state node '\".concat(stateIdentifier, \"'\"));\n      }\n\n      return stateNode.path;\n    }\n\n    return toStatePath(stateIdentifier, this.delimiter);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialStateValue\", {\n    get: function () {\n      var _a;\n\n      if (this.__cache.initialStateValue) {\n        return this.__cache.initialStateValue;\n      }\n\n      var initialStateValue;\n\n      if (this.type === 'parallel') {\n        initialStateValue = mapFilterValues(this.states, function (state) {\n          return state.initialStateValue || EMPTY_OBJECT;\n        }, function (stateNode) {\n          return !(stateNode.type === 'history');\n        });\n      } else if (this.initial !== undefined) {\n        if (!this.states[this.initial]) {\n          throw new Error(\"Initial state '\".concat(this.initial, \"' not found on '\").concat(this.key, \"'\"));\n        }\n\n        initialStateValue = isLeafNode(this.states[this.initial]) ? this.initial : (_a = {}, _a[this.initial] = this.states[this.initial].initialStateValue, _a);\n      } else {\n        // The finite state value of a machine without child states is just an empty object\n        initialStateValue = {};\n      }\n\n      this.__cache.initialStateValue = initialStateValue;\n      return this.__cache.initialStateValue;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateNode.prototype.getInitialState = function (stateValue, context) {\n    this._init(); // TODO: this should be in the constructor (see note in constructor)\n\n\n    var configuration = this.getStateNodes(stateValue);\n    return this.resolveTransition({\n      configuration: configuration,\n      entrySet: __spreadArray([], __read(configuration), false),\n      exitSet: [],\n      transitions: [],\n      source: undefined,\n      actions: []\n    }, undefined, context !== null && context !== void 0 ? context : this.machine.context, undefined);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialState\", {\n    /**\r\n     * The initial State instance, which includes all actions to be executed from\r\n     * entering the initial state.\r\n     */\n    get: function () {\n      var initialStateValue = this.initialStateValue;\n\n      if (!initialStateValue) {\n        throw new Error(\"Cannot retrieve initial state from simple state '\".concat(this.id, \"'.\"));\n      }\n\n      return this.getInitialState(initialStateValue);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"target\", {\n    /**\r\n     * The target state value of the history state node, if it exists. This represents the\r\n     * default state value to transition to if no history value exists yet.\r\n     */\n    get: function () {\n      var target;\n\n      if (this.type === 'history') {\n        var historyConfig = this.config;\n\n        if (isString(historyConfig.target)) {\n          target = isStateId(historyConfig.target) ? pathToStateValue(this.machine.getStateNodeById(historyConfig.target).path.slice(this.path.length - 1)) : historyConfig.target;\n        } else {\n          target = historyConfig.target;\n        }\n      }\n\n      return target;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Returns the leaf nodes from a state path relative to this state node.\r\n   *\r\n   * @param relativeStateId The relative state path to retrieve the state nodes\r\n   * @param history The previous state to retrieve history\r\n   * @param resolve Whether state nodes should resolve to initial child state nodes\r\n   */\n\n  StateNode.prototype.getRelativeStateNodes = function (relativeStateId, historyValue, resolve) {\n    if (resolve === void 0) {\n      resolve = true;\n    }\n\n    return resolve ? relativeStateId.type === 'history' ? relativeStateId.resolveHistory(historyValue) : relativeStateId.initialStateNodes : [relativeStateId];\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialStateNodes\", {\n    get: function () {\n      var _this = this;\n\n      if (isLeafNode(this)) {\n        return [this];\n      } // Case when state node is compound but no initial state is defined\n\n\n      if (this.type === 'compound' && !this.initial) {\n        if (!IS_PRODUCTION) {\n          warn(false, \"Compound state node '\".concat(this.id, \"' has no initial state.\"));\n        }\n\n        return [this];\n      }\n\n      var initialStateNodePaths = toStatePaths(this.initialStateValue);\n      return flatten(initialStateNodePaths.map(function (initialPath) {\n        return _this.getFromRelativePath(initialPath);\n      }));\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Retrieves state nodes from a relative path to this state node.\r\n   *\r\n   * @param relativePath The relative path from this state node\r\n   * @param historyValue\r\n   */\n\n  StateNode.prototype.getFromRelativePath = function (relativePath) {\n    if (!relativePath.length) {\n      return [this];\n    }\n\n    var _a = __read(relativePath),\n        stateKey = _a[0],\n        childStatePath = _a.slice(1);\n\n    if (!this.states) {\n      throw new Error(\"Cannot retrieve subPath '\".concat(stateKey, \"' from node with no states\"));\n    }\n\n    var childStateNode = this.getStateNode(stateKey);\n\n    if (childStateNode.type === 'history') {\n      return childStateNode.resolveHistory();\n    }\n\n    if (!this.states[stateKey]) {\n      throw new Error(\"Child state '\".concat(stateKey, \"' does not exist on '\").concat(this.id, \"'\"));\n    }\n\n    return this.states[stateKey].getFromRelativePath(childStatePath);\n  };\n\n  StateNode.prototype.historyValue = function (relativeStateValue) {\n    if (!Object.keys(this.states).length) {\n      return undefined;\n    }\n\n    return {\n      current: relativeStateValue || this.initialStateValue,\n      states: mapFilterValues(this.states, function (stateNode, key) {\n        if (!relativeStateValue) {\n          return stateNode.historyValue();\n        }\n\n        var subStateValue = isString(relativeStateValue) ? undefined : relativeStateValue[key];\n        return stateNode.historyValue(subStateValue || stateNode.initialStateValue);\n      }, function (stateNode) {\n        return !stateNode.history;\n      })\n    };\n  };\n  /**\r\n   * Resolves to the historical value(s) of the parent state node,\r\n   * represented by state nodes.\r\n   *\r\n   * @param historyValue\r\n   */\n\n\n  StateNode.prototype.resolveHistory = function (historyValue) {\n    var _this = this;\n\n    if (this.type !== 'history') {\n      return [this];\n    }\n\n    var parent = this.parent;\n\n    if (!historyValue) {\n      var historyTarget = this.target;\n      return historyTarget ? flatten(toStatePaths(historyTarget).map(function (relativeChildPath) {\n        return parent.getFromRelativePath(relativeChildPath);\n      })) : parent.initialStateNodes;\n    }\n\n    var subHistoryValue = nestedPath(parent.path, 'states')(historyValue).current;\n\n    if (isString(subHistoryValue)) {\n      return [parent.getStateNode(subHistoryValue)];\n    }\n\n    return flatten(toStatePaths(subHistoryValue).map(function (subStatePath) {\n      return _this.history === 'deep' ? parent.getFromRelativePath(subStatePath) : [parent.states[subStatePath[0]]];\n    }));\n  };\n\n  Object.defineProperty(StateNode.prototype, \"stateIds\", {\n    /**\r\n     * All the state node IDs of this state node and its descendant state nodes.\r\n     */\n    get: function () {\n      var _this = this;\n\n      var childStateIds = flatten(Object.keys(this.states).map(function (stateKey) {\n        return _this.states[stateKey].stateIds;\n      }));\n      return [this.id].concat(childStateIds);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"events\", {\n    /**\r\n     * All the event types accepted by this state node and its descendants.\r\n     */\n    get: function () {\n      var e_8, _a, e_9, _b;\n\n      if (this.__cache.events) {\n        return this.__cache.events;\n      }\n\n      var states = this.states;\n      var events = new Set(this.ownEvents);\n\n      if (states) {\n        try {\n          for (var _c = __values(Object.keys(states)), _d = _c.next(); !_d.done; _d = _c.next()) {\n            var stateId = _d.value;\n            var state = states[stateId];\n\n            if (state.states) {\n              try {\n                for (var _e = (e_9 = void 0, __values(state.events)), _f = _e.next(); !_f.done; _f = _e.next()) {\n                  var event_1 = _f.value;\n                  events.add(\"\".concat(event_1));\n                }\n              } catch (e_9_1) {\n                e_9 = {\n                  error: e_9_1\n                };\n              } finally {\n                try {\n                  if (_f && !_f.done && (_b = _e.return)) _b.call(_e);\n                } finally {\n                  if (e_9) throw e_9.error;\n                }\n              }\n            }\n          }\n        } catch (e_8_1) {\n          e_8 = {\n            error: e_8_1\n          };\n        } finally {\n          try {\n            if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n          } finally {\n            if (e_8) throw e_8.error;\n          }\n        }\n      }\n\n      return this.__cache.events = Array.from(events);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"ownEvents\", {\n    /**\r\n     * All the events that have transitions directly from this state node.\r\n     *\r\n     * Excludes any inert events.\r\n     */\n    get: function () {\n      var events = new Set(this.transitions.filter(function (transition) {\n        return !(!transition.target && !transition.actions.length && transition.internal);\n      }).map(function (transition) {\n        return transition.eventType;\n      }));\n      return Array.from(events);\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateNode.prototype.resolveTarget = function (_target) {\n    var _this = this;\n\n    if (_target === undefined) {\n      // an undefined target signals that the state node should not transition from that state when receiving that event\n      return undefined;\n    }\n\n    return _target.map(function (target) {\n      if (!isString(target)) {\n        return target;\n      }\n\n      var isInternalTarget = target[0] === _this.delimiter; // If internal target is defined on machine,\n      // do not include machine key on target\n\n      if (isInternalTarget && !_this.parent) {\n        return _this.getStateNodeByPath(target.slice(1));\n      }\n\n      var resolvedTarget = isInternalTarget ? _this.key + target : target;\n\n      if (_this.parent) {\n        try {\n          var targetStateNode = _this.parent.getStateNodeByPath(resolvedTarget);\n\n          return targetStateNode;\n        } catch (err) {\n          throw new Error(\"Invalid transition definition for state node '\".concat(_this.id, \"':\\n\").concat(err.message));\n        }\n      } else {\n        return _this.getStateNodeByPath(resolvedTarget);\n      }\n    });\n  };\n\n  StateNode.prototype.formatTransition = function (transitionConfig) {\n    var _this = this;\n\n    var normalizedTarget = normalizeTarget(transitionConfig.target);\n    var internal = 'internal' in transitionConfig ? transitionConfig.internal : normalizedTarget ? normalizedTarget.some(function (_target) {\n      return isString(_target) && _target[0] === _this.delimiter;\n    }) : true;\n    var guards = this.machine.options.guards;\n    var target = this.resolveTarget(normalizedTarget);\n\n    var transition = __assign(__assign({}, transitionConfig), {\n      actions: toActionObjects(toArray(transitionConfig.actions)),\n      cond: toGuard(transitionConfig.cond, guards),\n      target: target,\n      source: this,\n      internal: internal,\n      eventType: transitionConfig.event,\n      toJSON: function () {\n        return __assign(__assign({}, transition), {\n          target: transition.target ? transition.target.map(function (t) {\n            return \"#\".concat(t.id);\n          }) : undefined,\n          source: \"#\".concat(_this.id)\n        });\n      }\n    });\n\n    return transition;\n  };\n\n  StateNode.prototype.formatTransitions = function () {\n    var e_10, _a;\n\n    var _this = this;\n\n    var onConfig;\n\n    if (!this.config.on) {\n      onConfig = [];\n    } else if (Array.isArray(this.config.on)) {\n      onConfig = this.config.on;\n    } else {\n      var _b = this.config.on,\n          _c = WILDCARD,\n          _d = _b[_c],\n          wildcardConfigs = _d === void 0 ? [] : _d,\n          strictTransitionConfigs_1 = __rest(_b, [typeof _c === \"symbol\" ? _c : _c + \"\"]);\n\n      onConfig = flatten(Object.keys(strictTransitionConfigs_1).map(function (key) {\n        if (!IS_PRODUCTION && key === NULL_EVENT) {\n          warn(false, \"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. \" + \"Please check the `on` configuration for \\\"#\".concat(_this.id, \"\\\".\"));\n        }\n\n        var transitionConfigArray = toTransitionConfigArray(key, strictTransitionConfigs_1[key]);\n\n        if (!IS_PRODUCTION) {\n          validateArrayifiedTransitions(_this, key, transitionConfigArray);\n        }\n\n        return transitionConfigArray;\n      }).concat(toTransitionConfigArray(WILDCARD, wildcardConfigs)));\n    }\n\n    var eventlessConfig = this.config.always ? toTransitionConfigArray('', this.config.always) : [];\n    var doneConfig = this.config.onDone ? toTransitionConfigArray(String(done(this.id)), this.config.onDone) : [];\n\n    if (!IS_PRODUCTION) {\n      warn(!(this.config.onDone && !this.parent), \"Root nodes cannot have an \\\".onDone\\\" transition. Please check the config of \\\"\".concat(this.id, \"\\\".\"));\n    }\n\n    var invokeConfig = flatten(this.invoke.map(function (invokeDef) {\n      var settleTransitions = [];\n\n      if (invokeDef.onDone) {\n        settleTransitions.push.apply(settleTransitions, __spreadArray([], __read(toTransitionConfigArray(String(doneInvoke(invokeDef.id)), invokeDef.onDone)), false));\n      }\n\n      if (invokeDef.onError) {\n        settleTransitions.push.apply(settleTransitions, __spreadArray([], __read(toTransitionConfigArray(String(error(invokeDef.id)), invokeDef.onError)), false));\n      }\n\n      return settleTransitions;\n    }));\n    var delayedTransitions = this.after;\n    var formattedTransitions = flatten(__spreadArray(__spreadArray(__spreadArray(__spreadArray([], __read(doneConfig), false), __read(invokeConfig), false), __read(onConfig), false), __read(eventlessConfig), false).map(function (transitionConfig) {\n      return toArray(transitionConfig).map(function (transition) {\n        return _this.formatTransition(transition);\n      });\n    }));\n\n    try {\n      for (var delayedTransitions_1 = __values(delayedTransitions), delayedTransitions_1_1 = delayedTransitions_1.next(); !delayedTransitions_1_1.done; delayedTransitions_1_1 = delayedTransitions_1.next()) {\n        var delayedTransition = delayedTransitions_1_1.value;\n        formattedTransitions.push(delayedTransition);\n      }\n    } catch (e_10_1) {\n      e_10 = {\n        error: e_10_1\n      };\n    } finally {\n      try {\n        if (delayedTransitions_1_1 && !delayedTransitions_1_1.done && (_a = delayedTransitions_1.return)) _a.call(delayedTransitions_1);\n      } finally {\n        if (e_10) throw e_10.error;\n      }\n    }\n\n    return formattedTransitions;\n  };\n\n  return StateNode;\n}();\n\nexport { StateNode };","map":{"version":3,"names":["__assign","__spreadArray","__read","__values","__rest","isFunction","mapValues","isArray","flatten","toArray","toStateValue","isString","getEventType","toSCXMLEvent","matchesState","path","evaluateGuard","mapContext","pathToStateValue","isBuiltInEvent","partition","updateHistoryValue","toStatePath","mapFilterValues","warn","toStatePaths","nestedPath","normalizeTarget","toGuard","toTransitionConfigArray","isMachine","createInvokeId","SpecialTargets","State","stateValuesEqual","raise","raise$1","send","start","start$1","stop","stop$1","invoke","update","nullEvent","done","toActionObjects","resolveActions","doneInvoke","error","toActionObject","toActivityDefinition","after","send$1","cancel","initEvent","IS_PRODUCTION","STATE_DELIMITER","getAllStateNodes","getConfiguration","isInFinalState","getTagsFromConfiguration","has","getChildren","getValue","isLeafNode","getAllChildren","createInvocableActor","toInvokeDefinition","NULL_EVENT","STATE_IDENTIFIER","WILDCARD","EMPTY_OBJECT","isStateId","str","createDefaultOptions","actions","guards","services","activities","delays","validateArrayifiedTransitions","stateNode","event","transitions","hasNonLastUnguardedTarget","slice","some","transition","target","eventText","concat","id","StateNode","config","options","_context","_stateInfo","context","undefined","_this","_a","order","__xstatenode","__cache","events","relativeValue","Map","initialStateValue","initialState","on","candidates","delayedTransitions","idMap","tags","Object","assign","parent","key","machine","delimiter","join","version","type","parallel","states","keys","length","history","schema","description","initial","stateConfig","dfs","e_1","_b","_c","next","child","value","e_1_1","return","call","_transient","always","Array","strict","onEntry","entry","map","action","onExit","exit","meta","doneData","data","invokeConfig","i","invokeId","src","invokeSource","activity","bind","prototype","_init","forEach","withConfig","withContext","defineProperty","get","enumerable","configurable","state","definition","toJSON","reduce","eventType","push","getDelayedTransitions","formatTransitions","getCandidates","eventName","transient","filter","sameEventType","afterConfig","mutateEntryExit","delay","delayRef","configTransition","resolvedTransition","resolvedDelay","isNaN","delayedTransition","formatTransition","getStateNodes","stateValue","getStateNode","subStateKeys","subStateNodes","apply","subStateKey","handles","includes","resolveState","stateFromConfig","create","configuration","from","resolve","transitionLeafNode","_event","transitionCompoundNode","_transition","transitionParallelNode","e_2","transitionMap","subStateValue","subStateNode","e_2_1","stateTransitions","enabledTransitions","st","willTransition","entryNodes","t","entrySet","exitSet","source","getTransitionData","e_3","name","nextStateNodes","selectedTransition","candidate","cond","stateIn","in","resolvedContext","isInState","matches","getStateNodeById","guardPassed","err","Error","message","e_3_1","allNextStateNodes","getRelativeStateNodes","historyValue","isInternal","internal","reentryNodes","targetNode","getExternalReentryNodes","nodes","marker","possibleAncestor","getActions","resolvedConfig","isDone","currentContext","prevState","predictableExec","e_4","e_5","prevConfig","resolvedConfig_1","resolvedConfig_1_1","sn","e_4_1","prevConfig_1","prevConfig_1_1","e_5_1","doneEvents","grandparent","every","parentNode","sort","a","b","entryStates","Set","exitStates","entryActions","invokeActions","exitActions","stopActions","to","Internal","exec","currentState","resolvedStateValue","getResolvedPath","stateTransition","resolveTransition","resolveRaisedTransition","originalEvent","currentActions","unshift","e_6","e_7","resolvedConfiguration","actionBlocks","actionBlocks_1","actionBlocks_1_1","block","block_1","block_1_1","e_7_1","e_6_1","predictableActionArguments","preserveActionOrder","resolvedActions","updatedContext","_d","raisedEvents","nonRaisedActions","children","acc","nextState","_sessionid","didUpdateContext","changed","hasAlwaysTransitions","maybeNextState","raisedEvent","shift","stateKey","result","stateId","resolvedStateId","getStateNodeByPath","statePath","e","arrayStatePath","currentStateNode","stateIdentifier","getInitialState","historyConfig","relativeStateId","resolveHistory","initialStateNodes","initialStateNodePaths","initialPath","getFromRelativePath","relativePath","childStatePath","childStateNode","relativeStateValue","current","historyTarget","relativeChildPath","subHistoryValue","subStatePath","childStateIds","stateIds","e_8","e_9","ownEvents","_e","_f","event_1","add","e_9_1","e_8_1","resolveTarget","_target","isInternalTarget","resolvedTarget","targetStateNode","transitionConfig","normalizedTarget","e_10","onConfig","wildcardConfigs","strictTransitionConfigs_1","transitionConfigArray","eventlessConfig","doneConfig","onDone","String","invokeDef","settleTransitions","onError","formattedTransitions","delayedTransitions_1","delayedTransitions_1_1","e_10_1"],"sources":["C:/Users/lmore/OneDrive/Documents/GitHub/JacksOfAllTrades/jacksofalltrades/node_modules/xstate/es/StateNode.js"],"sourcesContent":["import { __assign, __spreadArray, __read, __values, __rest } from './_virtual/_tslib.js';\nimport { isFunction, mapValues, isArray, flatten, toArray, toStateValue, isString, getEventType, toSCXMLEvent, matchesState, path, evaluateGuard, mapContext, pathToStateValue, isBuiltInEvent, partition, updateHistoryValue, toStatePath, mapFilterValues, warn, toStatePaths, nestedPath, normalizeTarget, toGuard, toTransitionConfigArray, isMachine, createInvokeId } from './utils.js';\nimport { SpecialTargets } from './types.js';\nimport { State, stateValuesEqual } from './State.js';\nimport { raise as raise$1, send, start as start$1, stop as stop$1, invoke, update, nullEvent } from './actionTypes.js';\nimport { done, start, toActionObjects, raise, stop, resolveActions, doneInvoke, error, toActionObject, toActivityDefinition, after, send as send$1, cancel, initEvent } from './actions.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { STATE_DELIMITER } from './constants.js';\nimport { getAllStateNodes, getConfiguration, isInFinalState, getTagsFromConfiguration, has, getChildren, getValue, isLeafNode, getAllChildren } from './stateUtils.js';\nimport { createInvocableActor } from './Actor.js';\nimport { toInvokeDefinition } from './invokeUtils.js';\n\nvar NULL_EVENT = '';\nvar STATE_IDENTIFIER = '#';\nvar WILDCARD = '*';\nvar EMPTY_OBJECT = {};\n\nvar isStateId = function (str) {\n  return str[0] === STATE_IDENTIFIER;\n};\n\nvar createDefaultOptions = function () {\n  return {\n    actions: {},\n    guards: {},\n    services: {},\n    activities: {},\n    delays: {}\n  };\n};\n\nvar validateArrayifiedTransitions = function (stateNode, event, transitions) {\n  var hasNonLastUnguardedTarget = transitions.slice(0, -1).some(function (transition) {\n    return !('cond' in transition) && !('in' in transition) && (isString(transition.target) || isMachine(transition.target));\n  });\n  var eventText = event === NULL_EVENT ? 'the transient event' : \"event '\".concat(event, \"'\");\n  warn(!hasNonLastUnguardedTarget, \"One or more transitions for \".concat(eventText, \" on state '\").concat(stateNode.id, \"' are unreachable. \") + \"Make sure that the default transition is the last one defined.\");\n};\n\nvar StateNode =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  function StateNode(\n  /**\r\n   * The raw config used to create the machine.\r\n   */\n  config, options,\n  /**\r\n   * The initial extended state\r\n   */\n  _context, // TODO: this is unsafe, but we're removing it in v5 anyway\n  _stateInfo) {\n    if (_context === void 0) {\n      _context = 'context' in config ? config.context : undefined;\n    }\n\n    var _this = this;\n\n    var _a;\n\n    this.config = config;\n    this._context = _context;\n    /**\r\n     * The order this state node appears. Corresponds to the implicit SCXML document order.\r\n     */\n\n    this.order = -1;\n    this.__xstatenode = true;\n    this.__cache = {\n      events: undefined,\n      relativeValue: new Map(),\n      initialStateValue: undefined,\n      initialState: undefined,\n      on: undefined,\n      transitions: undefined,\n      candidates: {},\n      delayedTransitions: undefined\n    };\n    this.idMap = {};\n    this.tags = [];\n    this.options = Object.assign(createDefaultOptions(), options);\n    this.parent = _stateInfo === null || _stateInfo === void 0 ? void 0 : _stateInfo.parent;\n    this.key = this.config.key || (_stateInfo === null || _stateInfo === void 0 ? void 0 : _stateInfo.key) || this.config.id || '(machine)';\n    this.machine = this.parent ? this.parent.machine : this;\n    this.path = this.parent ? this.parent.path.concat(this.key) : [];\n    this.delimiter = this.config.delimiter || (this.parent ? this.parent.delimiter : STATE_DELIMITER);\n    this.id = this.config.id || __spreadArray([this.machine.key], __read(this.path), false).join(this.delimiter);\n    this.version = this.parent ? this.parent.version : this.config.version;\n    this.type = this.config.type || (this.config.parallel ? 'parallel' : this.config.states && Object.keys(this.config.states).length ? 'compound' : this.config.history ? 'history' : 'atomic');\n    this.schema = this.parent ? this.machine.schema : (_a = this.config.schema) !== null && _a !== void 0 ? _a : {};\n    this.description = this.config.description;\n\n    if (!IS_PRODUCTION) {\n      warn(!('parallel' in this.config), \"The \\\"parallel\\\" property is deprecated and will be removed in version 4.1. \".concat(this.config.parallel ? \"Replace with `type: 'parallel'`\" : \"Use `type: '\".concat(this.type, \"'`\"), \" in the config for state node '\").concat(this.id, \"' instead.\"));\n    }\n\n    this.initial = this.config.initial;\n    this.states = this.config.states ? mapValues(this.config.states, function (stateConfig, key) {\n      var _a;\n\n      var stateNode = new StateNode(stateConfig, {}, undefined, {\n        parent: _this,\n        key: key\n      });\n      Object.assign(_this.idMap, __assign((_a = {}, _a[stateNode.id] = stateNode, _a), stateNode.idMap));\n      return stateNode;\n    }) : EMPTY_OBJECT; // Document order\n\n    var order = 0;\n\n    function dfs(stateNode) {\n      var e_1, _a;\n\n      stateNode.order = order++;\n\n      try {\n        for (var _b = __values(getAllChildren(stateNode)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var child = _c.value;\n          dfs(child);\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n    }\n\n    dfs(this); // History config\n\n    this.history = this.config.history === true ? 'shallow' : this.config.history || false;\n    this._transient = !!this.config.always || (!this.config.on ? false : Array.isArray(this.config.on) ? this.config.on.some(function (_a) {\n      var event = _a.event;\n      return event === NULL_EVENT;\n    }) : NULL_EVENT in this.config.on);\n    this.strict = !!this.config.strict; // TODO: deprecate (entry)\n\n    this.onEntry = toArray(this.config.entry || this.config.onEntry).map(function (action) {\n      return toActionObject(action);\n    }); // TODO: deprecate (exit)\n\n    this.onExit = toArray(this.config.exit || this.config.onExit).map(function (action) {\n      return toActionObject(action);\n    });\n    this.meta = this.config.meta;\n    this.doneData = this.type === 'final' ? this.config.data : undefined;\n    this.invoke = toArray(this.config.invoke).map(function (invokeConfig, i) {\n      var _a, _b;\n\n      if (isMachine(invokeConfig)) {\n        var invokeId = createInvokeId(_this.id, i);\n        _this.machine.options.services = __assign((_a = {}, _a[invokeId] = invokeConfig, _a), _this.machine.options.services);\n        return toInvokeDefinition({\n          src: invokeId,\n          id: invokeId\n        });\n      } else if (isString(invokeConfig.src)) {\n        var invokeId = invokeConfig.id || createInvokeId(_this.id, i);\n        return toInvokeDefinition(__assign(__assign({}, invokeConfig), {\n          id: invokeId,\n          src: invokeConfig.src\n        }));\n      } else if (isMachine(invokeConfig.src) || isFunction(invokeConfig.src)) {\n        var invokeId = invokeConfig.id || createInvokeId(_this.id, i);\n        _this.machine.options.services = __assign((_b = {}, _b[invokeId] = invokeConfig.src, _b), _this.machine.options.services);\n        return toInvokeDefinition(__assign(__assign({\n          id: invokeId\n        }, invokeConfig), {\n          src: invokeId\n        }));\n      } else {\n        var invokeSource = invokeConfig.src;\n        return toInvokeDefinition(__assign(__assign({\n          id: createInvokeId(_this.id, i)\n        }, invokeConfig), {\n          src: invokeSource\n        }));\n      }\n    });\n    this.activities = toArray(this.config.activities).concat(this.invoke).map(function (activity) {\n      return toActivityDefinition(activity);\n    });\n    this.transition = this.transition.bind(this);\n    this.tags = toArray(this.config.tags); // TODO: this is the real fix for initialization once\n    // state node getters are deprecated\n    // if (!this.parent) {\n    //   this._init();\n    // }\n  }\n\n  StateNode.prototype._init = function () {\n    if (this.__cache.transitions) {\n      return;\n    }\n\n    getAllStateNodes(this).forEach(function (stateNode) {\n      return stateNode.on;\n    });\n  };\n  /**\r\n   * Clones this state machine with custom options and context.\r\n   *\r\n   * @param options Options (actions, guards, activities, services) to recursively merge with the existing options.\r\n   * @param context Custom context (will override predefined context)\r\n   */\n\n\n  StateNode.prototype.withConfig = function (options, context) {\n    var _a = this.options,\n        actions = _a.actions,\n        activities = _a.activities,\n        guards = _a.guards,\n        services = _a.services,\n        delays = _a.delays;\n    return new StateNode(this.config, {\n      actions: __assign(__assign({}, actions), options.actions),\n      activities: __assign(__assign({}, activities), options.activities),\n      guards: __assign(__assign({}, guards), options.guards),\n      services: __assign(__assign({}, services), options.services),\n      delays: __assign(__assign({}, delays), options.delays)\n    }, context !== null && context !== void 0 ? context : this.context);\n  };\n  /**\r\n   * Clones this state machine with custom context.\r\n   *\r\n   * @param context Custom context (will override predefined context, not recursive)\r\n   */\n\n\n  StateNode.prototype.withContext = function (context) {\n    return new StateNode(this.config, this.options, context);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"context\", {\n    get: function () {\n      return isFunction(this._context) ? this._context() : this._context;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"definition\", {\n    /**\r\n     * The well-structured state node definition.\r\n     */\n    get: function () {\n      return {\n        id: this.id,\n        key: this.key,\n        version: this.version,\n        context: this.context,\n        type: this.type,\n        initial: this.initial,\n        history: this.history,\n        states: mapValues(this.states, function (state) {\n          return state.definition;\n        }),\n        on: this.on,\n        transitions: this.transitions,\n        entry: this.onEntry,\n        exit: this.onExit,\n        activities: this.activities || [],\n        meta: this.meta,\n        order: this.order || -1,\n        data: this.doneData,\n        invoke: this.invoke,\n        description: this.description,\n        tags: this.tags\n      };\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateNode.prototype.toJSON = function () {\n    return this.definition;\n  };\n\n  Object.defineProperty(StateNode.prototype, \"on\", {\n    /**\r\n     * The mapping of events to transitions.\r\n     */\n    get: function () {\n      if (this.__cache.on) {\n        return this.__cache.on;\n      }\n\n      var transitions = this.transitions;\n      return this.__cache.on = transitions.reduce(function (map, transition) {\n        map[transition.eventType] = map[transition.eventType] || [];\n        map[transition.eventType].push(transition);\n        return map;\n      }, {});\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"after\", {\n    get: function () {\n      return this.__cache.delayedTransitions || (this.__cache.delayedTransitions = this.getDelayedTransitions(), this.__cache.delayedTransitions);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"transitions\", {\n    /**\r\n     * All the transitions that can be taken from this state node.\r\n     */\n    get: function () {\n      return this.__cache.transitions || (this.__cache.transitions = this.formatTransitions(), this.__cache.transitions);\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateNode.prototype.getCandidates = function (eventName) {\n    if (this.__cache.candidates[eventName]) {\n      return this.__cache.candidates[eventName];\n    }\n\n    var transient = eventName === NULL_EVENT;\n    var candidates = this.transitions.filter(function (transition) {\n      var sameEventType = transition.eventType === eventName; // null events should only match against eventless transitions\n\n      return transient ? sameEventType : sameEventType || transition.eventType === WILDCARD;\n    });\n    this.__cache.candidates[eventName] = candidates;\n    return candidates;\n  };\n  /**\r\n   * All delayed transitions from the config.\r\n   */\n\n\n  StateNode.prototype.getDelayedTransitions = function () {\n    var _this = this;\n\n    var afterConfig = this.config.after;\n\n    if (!afterConfig) {\n      return [];\n    }\n\n    var mutateEntryExit = function (delay, i) {\n      var delayRef = isFunction(delay) ? \"\".concat(_this.id, \":delay[\").concat(i, \"]\") : delay;\n      var eventType = after(delayRef, _this.id);\n\n      _this.onEntry.push(send$1(eventType, {\n        delay: delay\n      }));\n\n      _this.onExit.push(cancel(eventType));\n\n      return eventType;\n    };\n\n    var delayedTransitions = isArray(afterConfig) ? afterConfig.map(function (transition, i) {\n      var eventType = mutateEntryExit(transition.delay, i);\n      return __assign(__assign({}, transition), {\n        event: eventType\n      });\n    }) : flatten(Object.keys(afterConfig).map(function (delay, i) {\n      var configTransition = afterConfig[delay];\n      var resolvedTransition = isString(configTransition) ? {\n        target: configTransition\n      } : configTransition;\n      var resolvedDelay = !isNaN(+delay) ? +delay : delay;\n      var eventType = mutateEntryExit(resolvedDelay, i);\n      return toArray(resolvedTransition).map(function (transition) {\n        return __assign(__assign({}, transition), {\n          event: eventType,\n          delay: resolvedDelay\n        });\n      });\n    }));\n    return delayedTransitions.map(function (delayedTransition) {\n      var delay = delayedTransition.delay;\n      return __assign(__assign({}, _this.formatTransition(delayedTransition)), {\n        delay: delay\n      });\n    });\n  };\n  /**\r\n   * Returns the state nodes represented by the current state value.\r\n   *\r\n   * @param state The state value or State instance\r\n   */\n\n\n  StateNode.prototype.getStateNodes = function (state) {\n    var _a;\n\n    var _this = this;\n\n    if (!state) {\n      return [];\n    }\n\n    var stateValue = state instanceof State ? state.value : toStateValue(state, this.delimiter);\n\n    if (isString(stateValue)) {\n      var initialStateValue = this.getStateNode(stateValue).initial;\n      return initialStateValue !== undefined ? this.getStateNodes((_a = {}, _a[stateValue] = initialStateValue, _a)) : [this, this.states[stateValue]];\n    }\n\n    var subStateKeys = Object.keys(stateValue);\n    var subStateNodes = [this];\n    subStateNodes.push.apply(subStateNodes, __spreadArray([], __read(flatten(subStateKeys.map(function (subStateKey) {\n      return _this.getStateNode(subStateKey).getStateNodes(stateValue[subStateKey]);\n    }))), false));\n    return subStateNodes;\n  };\n  /**\r\n   * Returns `true` if this state node explicitly handles the given event.\r\n   *\r\n   * @param event The event in question\r\n   */\n\n\n  StateNode.prototype.handles = function (event) {\n    var eventType = getEventType(event);\n    return this.events.includes(eventType);\n  };\n  /**\r\n   * Resolves the given `state` to a new `State` instance relative to this machine.\r\n   *\r\n   * This ensures that `.events` and `.nextEvents` represent the correct values.\r\n   *\r\n   * @param state The state to resolve\r\n   */\n\n\n  StateNode.prototype.resolveState = function (state) {\n    var stateFromConfig = state instanceof State ? state : State.create(state);\n    var configuration = Array.from(getConfiguration([], this.getStateNodes(stateFromConfig.value)));\n    return new State(__assign(__assign({}, stateFromConfig), {\n      value: this.resolve(stateFromConfig.value),\n      configuration: configuration,\n      done: isInFinalState(configuration, this),\n      tags: getTagsFromConfiguration(configuration),\n      machine: this.machine\n    }));\n  };\n\n  StateNode.prototype.transitionLeafNode = function (stateValue, state, _event) {\n    var stateNode = this.getStateNode(stateValue);\n    var next = stateNode.next(state, _event);\n\n    if (!next || !next.transitions.length) {\n      return this.next(state, _event);\n    }\n\n    return next;\n  };\n\n  StateNode.prototype.transitionCompoundNode = function (stateValue, state, _event) {\n    var subStateKeys = Object.keys(stateValue);\n    var stateNode = this.getStateNode(subStateKeys[0]);\n\n    var next = stateNode._transition(stateValue[subStateKeys[0]], state, _event);\n\n    if (!next || !next.transitions.length) {\n      return this.next(state, _event);\n    }\n\n    return next;\n  };\n\n  StateNode.prototype.transitionParallelNode = function (stateValue, state, _event) {\n    var e_2, _a;\n\n    var transitionMap = {};\n\n    try {\n      for (var _b = __values(Object.keys(stateValue)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var subStateKey = _c.value;\n        var subStateValue = stateValue[subStateKey];\n\n        if (!subStateValue) {\n          continue;\n        }\n\n        var subStateNode = this.getStateNode(subStateKey);\n\n        var next = subStateNode._transition(subStateValue, state, _event);\n\n        if (next) {\n          transitionMap[subStateKey] = next;\n        }\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    var stateTransitions = Object.keys(transitionMap).map(function (key) {\n      return transitionMap[key];\n    });\n    var enabledTransitions = flatten(stateTransitions.map(function (st) {\n      return st.transitions;\n    }));\n    var willTransition = stateTransitions.some(function (st) {\n      return st.transitions.length > 0;\n    });\n\n    if (!willTransition) {\n      return this.next(state, _event);\n    }\n\n    var entryNodes = flatten(stateTransitions.map(function (t) {\n      return t.entrySet;\n    }));\n    var configuration = flatten(Object.keys(transitionMap).map(function (key) {\n      return transitionMap[key].configuration;\n    }));\n    return {\n      transitions: enabledTransitions,\n      entrySet: entryNodes,\n      exitSet: flatten(stateTransitions.map(function (t) {\n        return t.exitSet;\n      })),\n      configuration: configuration,\n      source: state,\n      actions: flatten(Object.keys(transitionMap).map(function (key) {\n        return transitionMap[key].actions;\n      }))\n    };\n  };\n\n  StateNode.prototype._transition = function (stateValue, state, _event) {\n    // leaf node\n    if (isString(stateValue)) {\n      return this.transitionLeafNode(stateValue, state, _event);\n    } // hierarchical node\n\n\n    if (Object.keys(stateValue).length === 1) {\n      return this.transitionCompoundNode(stateValue, state, _event);\n    } // orthogonal node\n\n\n    return this.transitionParallelNode(stateValue, state, _event);\n  };\n\n  StateNode.prototype.getTransitionData = function (state, event) {\n    return this._transition(state.value, state, toSCXMLEvent(event));\n  };\n\n  StateNode.prototype.next = function (state, _event) {\n    var e_3, _a;\n\n    var _this = this;\n\n    var eventName = _event.name;\n    var actions = [];\n    var nextStateNodes = [];\n    var selectedTransition;\n\n    try {\n      for (var _b = __values(this.getCandidates(eventName)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var candidate = _c.value;\n        var cond = candidate.cond,\n            stateIn = candidate.in;\n        var resolvedContext = state.context;\n        var isInState = stateIn ? isString(stateIn) && isStateId(stateIn) ? // Check if in state by ID\n        state.matches(toStateValue(this.getStateNodeById(stateIn).path, this.delimiter)) : // Check if in state by relative grandparent\n        matchesState(toStateValue(stateIn, this.delimiter), path(this.path.slice(0, -2))(state.value)) : true;\n        var guardPassed = false;\n\n        try {\n          guardPassed = !cond || evaluateGuard(this.machine, cond, resolvedContext, _event, state);\n        } catch (err) {\n          throw new Error(\"Unable to evaluate guard '\".concat(cond.name || cond.type, \"' in transition for event '\").concat(eventName, \"' in state node '\").concat(this.id, \"':\\n\").concat(err.message));\n        }\n\n        if (guardPassed && isInState) {\n          if (candidate.target !== undefined) {\n            nextStateNodes = candidate.target;\n          }\n\n          actions.push.apply(actions, __spreadArray([], __read(candidate.actions), false));\n          selectedTransition = candidate;\n          break;\n        }\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    if (!selectedTransition) {\n      return undefined;\n    }\n\n    if (!nextStateNodes.length) {\n      return {\n        transitions: [selectedTransition],\n        entrySet: [],\n        exitSet: [],\n        configuration: state.value ? [this] : [],\n        source: state,\n        actions: actions\n      };\n    }\n\n    var allNextStateNodes = flatten(nextStateNodes.map(function (stateNode) {\n      return _this.getRelativeStateNodes(stateNode, state.historyValue);\n    }));\n    var isInternal = !!selectedTransition.internal;\n    var reentryNodes = [];\n\n    if (!isInternal) {\n      nextStateNodes.forEach(function (targetNode) {\n        reentryNodes.push.apply(reentryNodes, __spreadArray([], __read(_this.getExternalReentryNodes(targetNode)), false));\n      });\n    }\n\n    return {\n      transitions: [selectedTransition],\n      entrySet: reentryNodes,\n      exitSet: isInternal ? [] : [this],\n      configuration: allNextStateNodes,\n      source: state,\n      actions: actions\n    };\n  };\n\n  StateNode.prototype.getExternalReentryNodes = function (targetNode) {\n    var nodes = [];\n\n    var _a = __read(targetNode.order > this.order ? [targetNode, this] : [this, targetNode], 2),\n        marker = _a[0],\n        possibleAncestor = _a[1];\n\n    while (marker && marker !== possibleAncestor) {\n      nodes.push(marker);\n      marker = marker.parent;\n    }\n\n    if (marker !== possibleAncestor) {\n      // we never got to `possibleAncestor`, therefore the initial `marker` \"escapes\" it\n      // it's in a different part of the tree so no states will be reentered for such an external transition\n      return [];\n    }\n\n    nodes.push(possibleAncestor);\n    return nodes;\n  };\n\n  StateNode.prototype.getActions = function (resolvedConfig, isDone, transition, currentContext, _event, prevState, predictableExec) {\n    var e_4, _a, e_5, _b;\n\n    var _this = this;\n\n    var prevConfig = getConfiguration([], prevState ? this.getStateNodes(prevState.value) : [this]);\n\n    try {\n      for (var resolvedConfig_1 = __values(resolvedConfig), resolvedConfig_1_1 = resolvedConfig_1.next(); !resolvedConfig_1_1.done; resolvedConfig_1_1 = resolvedConfig_1.next()) {\n        var sn = resolvedConfig_1_1.value;\n\n        if (!has(prevConfig, sn) || has(transition.entrySet, sn.parent)) {\n          transition.entrySet.push(sn);\n        }\n      }\n    } catch (e_4_1) {\n      e_4 = {\n        error: e_4_1\n      };\n    } finally {\n      try {\n        if (resolvedConfig_1_1 && !resolvedConfig_1_1.done && (_a = resolvedConfig_1.return)) _a.call(resolvedConfig_1);\n      } finally {\n        if (e_4) throw e_4.error;\n      }\n    }\n\n    try {\n      for (var prevConfig_1 = __values(prevConfig), prevConfig_1_1 = prevConfig_1.next(); !prevConfig_1_1.done; prevConfig_1_1 = prevConfig_1.next()) {\n        var sn = prevConfig_1_1.value;\n\n        if (!has(resolvedConfig, sn) || has(transition.exitSet, sn.parent)) {\n          transition.exitSet.push(sn);\n        }\n      }\n    } catch (e_5_1) {\n      e_5 = {\n        error: e_5_1\n      };\n    } finally {\n      try {\n        if (prevConfig_1_1 && !prevConfig_1_1.done && (_b = prevConfig_1.return)) _b.call(prevConfig_1);\n      } finally {\n        if (e_5) throw e_5.error;\n      }\n    }\n\n    var doneEvents = flatten(transition.entrySet.map(function (sn) {\n      var events = [];\n\n      if (sn.type !== 'final') {\n        return events;\n      }\n\n      var parent = sn.parent;\n\n      if (!parent.parent) {\n        return events;\n      }\n\n      events.push(done(sn.id, sn.doneData), // TODO: deprecate - final states should not emit done events for their own state.\n      done(parent.id, sn.doneData ? mapContext(sn.doneData, currentContext, _event) : undefined));\n      var grandparent = parent.parent;\n\n      if (grandparent.type === 'parallel') {\n        if (getChildren(grandparent).every(function (parentNode) {\n          return isInFinalState(transition.configuration, parentNode);\n        })) {\n          events.push(done(grandparent.id));\n        }\n      }\n\n      return events;\n    }));\n    transition.exitSet.sort(function (a, b) {\n      return b.order - a.order;\n    });\n    transition.entrySet.sort(function (a, b) {\n      return a.order - b.order;\n    });\n    var entryStates = new Set(transition.entrySet);\n    var exitStates = new Set(transition.exitSet);\n    var entryActions = Array.from(entryStates).map(function (stateNode) {\n      var entryActions = stateNode.onEntry;\n      var invokeActions = stateNode.activities.map(function (activity) {\n        return start(activity);\n      });\n      return toActionObjects(predictableExec ? __spreadArray(__spreadArray([], __read(entryActions), false), __read(invokeActions), false) : __spreadArray(__spreadArray([], __read(invokeActions), false), __read(entryActions), false), _this.machine.options.actions);\n    }).concat([doneEvents.map(raise)]);\n    var exitActions = Array.from(exitStates).map(function (stateNode) {\n      return toActionObjects(__spreadArray(__spreadArray([], __read(stateNode.onExit), false), __read(stateNode.activities.map(function (activity) {\n        return stop(activity);\n      })), false), _this.machine.options.actions);\n    });\n    var actions = exitActions.concat([toActionObjects(transition.actions, this.machine.options.actions)]).concat(entryActions);\n\n    if (isDone) {\n      var stopActions = toActionObjects(flatten(__spreadArray([], __read(resolvedConfig), false).sort(function (a, b) {\n        return b.order - a.order;\n      }).map(function (stateNode) {\n        return stateNode.onExit;\n      })), this.machine.options.actions).filter(function (action) {\n        return action.type !== raise$1 && (action.type !== send || !!action.to && action.to !== SpecialTargets.Internal);\n      });\n      return actions.concat([stopActions]);\n    }\n\n    return actions;\n  };\n  /**\r\n   * Determines the next state given the current `state` and sent `event`.\r\n   *\r\n   * @param state The current State instance or state value\r\n   * @param event The event that was sent at the current state\r\n   * @param context The current context (extended state) of the current state\r\n   */\n\n\n  StateNode.prototype.transition = function (state, event, context, exec) {\n    if (state === void 0) {\n      state = this.initialState;\n    }\n\n    var _event = toSCXMLEvent(event);\n\n    var currentState;\n\n    if (state instanceof State) {\n      currentState = context === undefined ? state : this.resolveState(State.from(state, context));\n    } else {\n      var resolvedStateValue = isString(state) ? this.resolve(pathToStateValue(this.getResolvedPath(state))) : this.resolve(state);\n      var resolvedContext = context !== null && context !== void 0 ? context : this.machine.context;\n      currentState = this.resolveState(State.from(resolvedStateValue, resolvedContext));\n    }\n\n    if (!IS_PRODUCTION && _event.name === WILDCARD) {\n      throw new Error(\"An event cannot have the wildcard type ('\".concat(WILDCARD, \"')\"));\n    }\n\n    if (this.strict) {\n      if (!this.events.includes(_event.name) && !isBuiltInEvent(_event.name)) {\n        throw new Error(\"Machine '\".concat(this.id, \"' does not accept event '\").concat(_event.name, \"'\"));\n      }\n    }\n\n    var stateTransition = this._transition(currentState.value, currentState, _event) || {\n      transitions: [],\n      configuration: [],\n      entrySet: [],\n      exitSet: [],\n      source: currentState,\n      actions: []\n    };\n    var prevConfig = getConfiguration([], this.getStateNodes(currentState.value));\n    var resolvedConfig = stateTransition.configuration.length ? getConfiguration(prevConfig, stateTransition.configuration) : prevConfig;\n    stateTransition.configuration = __spreadArray([], __read(resolvedConfig), false);\n    return this.resolveTransition(stateTransition, currentState, currentState.context, exec, _event);\n  };\n\n  StateNode.prototype.resolveRaisedTransition = function (state, _event, originalEvent, predictableExec) {\n    var _a;\n\n    var currentActions = state.actions;\n    state = this.transition(state, _event, undefined, predictableExec); // Save original event to state\n    // TODO: this should be the raised event! Delete in V5 (breaking)\n\n    state._event = originalEvent;\n    state.event = originalEvent.data;\n\n    (_a = state.actions).unshift.apply(_a, __spreadArray([], __read(currentActions), false));\n\n    return state;\n  };\n\n  StateNode.prototype.resolveTransition = function (stateTransition, currentState, context, predictableExec, _event) {\n    var e_6, _a, e_7, _b;\n\n    var _this = this;\n\n    if (_event === void 0) {\n      _event = initEvent;\n    }\n\n    var configuration = stateTransition.configuration; // Transition will \"apply\" if:\n    // - this is the initial state (there is no current state)\n    // - OR there are transitions\n\n    var willTransition = !currentState || stateTransition.transitions.length > 0;\n    var resolvedConfiguration = willTransition ? stateTransition.configuration : currentState ? currentState.configuration : [];\n    var isDone = isInFinalState(resolvedConfiguration, this);\n    var resolvedStateValue = willTransition ? getValue(this.machine, configuration) : undefined;\n    var historyValue = currentState ? currentState.historyValue ? currentState.historyValue : stateTransition.source ? this.machine.historyValue(currentState.value) : undefined : undefined;\n    var actionBlocks = this.getActions(new Set(resolvedConfiguration), isDone, stateTransition, context, _event, currentState, predictableExec);\n    var activities = currentState ? __assign({}, currentState.activities) : {};\n\n    try {\n      for (var actionBlocks_1 = __values(actionBlocks), actionBlocks_1_1 = actionBlocks_1.next(); !actionBlocks_1_1.done; actionBlocks_1_1 = actionBlocks_1.next()) {\n        var block = actionBlocks_1_1.value;\n\n        try {\n          for (var block_1 = (e_7 = void 0, __values(block)), block_1_1 = block_1.next(); !block_1_1.done; block_1_1 = block_1.next()) {\n            var action = block_1_1.value;\n\n            if (action.type === start$1) {\n              activities[action.activity.id || action.activity.type] = action;\n            } else if (action.type === stop$1) {\n              activities[action.activity.id || action.activity.type] = false;\n            }\n          }\n        } catch (e_7_1) {\n          e_7 = {\n            error: e_7_1\n          };\n        } finally {\n          try {\n            if (block_1_1 && !block_1_1.done && (_b = block_1.return)) _b.call(block_1);\n          } finally {\n            if (e_7) throw e_7.error;\n          }\n        }\n      }\n    } catch (e_6_1) {\n      e_6 = {\n        error: e_6_1\n      };\n    } finally {\n      try {\n        if (actionBlocks_1_1 && !actionBlocks_1_1.done && (_a = actionBlocks_1.return)) _a.call(actionBlocks_1);\n      } finally {\n        if (e_6) throw e_6.error;\n      }\n    }\n\n    var _c = __read(resolveActions(this, currentState, context, _event, actionBlocks, predictableExec, this.machine.config.predictableActionArguments || this.machine.config.preserveActionOrder), 2),\n        resolvedActions = _c[0],\n        updatedContext = _c[1];\n\n    var _d = __read(partition(resolvedActions, function (action) {\n      return action.type === raise$1 || action.type === send && action.to === SpecialTargets.Internal;\n    }), 2),\n        raisedEvents = _d[0],\n        nonRaisedActions = _d[1];\n\n    var invokeActions = resolvedActions.filter(function (action) {\n      var _a;\n\n      return action.type === start$1 && ((_a = action.activity) === null || _a === void 0 ? void 0 : _a.type) === invoke;\n    });\n    var children = invokeActions.reduce(function (acc, action) {\n      acc[action.activity.id] = createInvocableActor(action.activity, _this.machine, updatedContext, _event);\n      return acc;\n    }, currentState ? __assign({}, currentState.children) : {});\n    var nextState = new State({\n      value: resolvedStateValue || currentState.value,\n      context: updatedContext,\n      _event: _event,\n      // Persist _sessionid between states\n      _sessionid: currentState ? currentState._sessionid : null,\n      historyValue: resolvedStateValue ? historyValue ? updateHistoryValue(historyValue, resolvedStateValue) : undefined : currentState ? currentState.historyValue : undefined,\n      history: !resolvedStateValue || stateTransition.source ? currentState : undefined,\n      actions: resolvedStateValue ? nonRaisedActions : [],\n      activities: resolvedStateValue ? activities : currentState ? currentState.activities : {},\n      events: [],\n      configuration: resolvedConfiguration,\n      transitions: stateTransition.transitions,\n      children: children,\n      done: isDone,\n      tags: getTagsFromConfiguration(resolvedConfiguration),\n      machine: this\n    });\n    var didUpdateContext = context !== updatedContext;\n    nextState.changed = _event.name === update || didUpdateContext; // Dispose of penultimate histories to prevent memory leaks\n\n    var history = nextState.history;\n\n    if (history) {\n      delete history.history;\n    } // There are transient transitions if the machine is not in a final state\n    // and if some of the state nodes have transient (\"always\") transitions.\n\n\n    var hasAlwaysTransitions = !isDone && (this._transient || configuration.some(function (stateNode) {\n      return stateNode._transient;\n    })); // If there are no enabled transitions, check if there are transient transitions.\n    // If there are transient transitions, continue checking for more transitions\n    // because an transient transition should be triggered even if there are no\n    // enabled transitions.\n    //\n    // If we're already working on an transient transition then stop to prevent an infinite loop.\n    //\n    // Otherwise, if there are no enabled nor transient transitions, we are done.\n\n    if (!willTransition && (!hasAlwaysTransitions || _event.name === NULL_EVENT)) {\n      return nextState;\n    }\n\n    var maybeNextState = nextState;\n\n    if (!isDone) {\n      if (hasAlwaysTransitions) {\n        maybeNextState = this.resolveRaisedTransition(maybeNextState, {\n          type: nullEvent\n        }, _event, predictableExec);\n      }\n\n      while (raisedEvents.length) {\n        var raisedEvent = raisedEvents.shift();\n        maybeNextState = this.resolveRaisedTransition(maybeNextState, raisedEvent._event, _event, predictableExec);\n      }\n    } // Detect if state changed\n\n\n    var changed = maybeNextState.changed || (history ? !!maybeNextState.actions.length || didUpdateContext || typeof history.value !== typeof maybeNextState.value || !stateValuesEqual(maybeNextState.value, history.value) : undefined);\n    maybeNextState.changed = changed; // Preserve original history after raised events\n\n    maybeNextState.history = history;\n    return maybeNextState;\n  };\n  /**\r\n   * Returns the child state node from its relative `stateKey`, or throws.\r\n   */\n\n\n  StateNode.prototype.getStateNode = function (stateKey) {\n    if (isStateId(stateKey)) {\n      return this.machine.getStateNodeById(stateKey);\n    }\n\n    if (!this.states) {\n      throw new Error(\"Unable to retrieve child state '\".concat(stateKey, \"' from '\").concat(this.id, \"'; no child states exist.\"));\n    }\n\n    var result = this.states[stateKey];\n\n    if (!result) {\n      throw new Error(\"Child state '\".concat(stateKey, \"' does not exist on '\").concat(this.id, \"'\"));\n    }\n\n    return result;\n  };\n  /**\r\n   * Returns the state node with the given `stateId`, or throws.\r\n   *\r\n   * @param stateId The state ID. The prefix \"#\" is removed.\r\n   */\n\n\n  StateNode.prototype.getStateNodeById = function (stateId) {\n    var resolvedStateId = isStateId(stateId) ? stateId.slice(STATE_IDENTIFIER.length) : stateId;\n\n    if (resolvedStateId === this.id) {\n      return this;\n    }\n\n    var stateNode = this.machine.idMap[resolvedStateId];\n\n    if (!stateNode) {\n      throw new Error(\"Child state node '#\".concat(resolvedStateId, \"' does not exist on machine '\").concat(this.id, \"'\"));\n    }\n\n    return stateNode;\n  };\n  /**\r\n   * Returns the relative state node from the given `statePath`, or throws.\r\n   *\r\n   * @param statePath The string or string array relative path to the state node.\r\n   */\n\n\n  StateNode.prototype.getStateNodeByPath = function (statePath) {\n    if (typeof statePath === 'string' && isStateId(statePath)) {\n      try {\n        return this.getStateNodeById(statePath.slice(1));\n      } catch (e) {// try individual paths\n        // throw e;\n      }\n    }\n\n    var arrayStatePath = toStatePath(statePath, this.delimiter).slice();\n    var currentStateNode = this;\n\n    while (arrayStatePath.length) {\n      var key = arrayStatePath.shift();\n\n      if (!key.length) {\n        break;\n      }\n\n      currentStateNode = currentStateNode.getStateNode(key);\n    }\n\n    return currentStateNode;\n  };\n  /**\r\n   * Resolves a partial state value with its full representation in this machine.\r\n   *\r\n   * @param stateValue The partial state value to resolve.\r\n   */\n\n\n  StateNode.prototype.resolve = function (stateValue) {\n    var _a;\n\n    var _this = this;\n\n    if (!stateValue) {\n      return this.initialStateValue || EMPTY_OBJECT; // TODO: type-specific properties\n    }\n\n    switch (this.type) {\n      case 'parallel':\n        return mapValues(this.initialStateValue, function (subStateValue, subStateKey) {\n          return subStateValue ? _this.getStateNode(subStateKey).resolve(stateValue[subStateKey] || subStateValue) : EMPTY_OBJECT;\n        });\n\n      case 'compound':\n        if (isString(stateValue)) {\n          var subStateNode = this.getStateNode(stateValue);\n\n          if (subStateNode.type === 'parallel' || subStateNode.type === 'compound') {\n            return _a = {}, _a[stateValue] = subStateNode.initialStateValue, _a;\n          }\n\n          return stateValue;\n        }\n\n        if (!Object.keys(stateValue).length) {\n          return this.initialStateValue || {};\n        }\n\n        return mapValues(stateValue, function (subStateValue, subStateKey) {\n          return subStateValue ? _this.getStateNode(subStateKey).resolve(subStateValue) : EMPTY_OBJECT;\n        });\n\n      default:\n        return stateValue || EMPTY_OBJECT;\n    }\n  };\n\n  StateNode.prototype.getResolvedPath = function (stateIdentifier) {\n    if (isStateId(stateIdentifier)) {\n      var stateNode = this.machine.idMap[stateIdentifier.slice(STATE_IDENTIFIER.length)];\n\n      if (!stateNode) {\n        throw new Error(\"Unable to find state node '\".concat(stateIdentifier, \"'\"));\n      }\n\n      return stateNode.path;\n    }\n\n    return toStatePath(stateIdentifier, this.delimiter);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialStateValue\", {\n    get: function () {\n      var _a;\n\n      if (this.__cache.initialStateValue) {\n        return this.__cache.initialStateValue;\n      }\n\n      var initialStateValue;\n\n      if (this.type === 'parallel') {\n        initialStateValue = mapFilterValues(this.states, function (state) {\n          return state.initialStateValue || EMPTY_OBJECT;\n        }, function (stateNode) {\n          return !(stateNode.type === 'history');\n        });\n      } else if (this.initial !== undefined) {\n        if (!this.states[this.initial]) {\n          throw new Error(\"Initial state '\".concat(this.initial, \"' not found on '\").concat(this.key, \"'\"));\n        }\n\n        initialStateValue = isLeafNode(this.states[this.initial]) ? this.initial : (_a = {}, _a[this.initial] = this.states[this.initial].initialStateValue, _a);\n      } else {\n        // The finite state value of a machine without child states is just an empty object\n        initialStateValue = {};\n      }\n\n      this.__cache.initialStateValue = initialStateValue;\n      return this.__cache.initialStateValue;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateNode.prototype.getInitialState = function (stateValue, context) {\n    this._init(); // TODO: this should be in the constructor (see note in constructor)\n\n\n    var configuration = this.getStateNodes(stateValue);\n    return this.resolveTransition({\n      configuration: configuration,\n      entrySet: __spreadArray([], __read(configuration), false),\n      exitSet: [],\n      transitions: [],\n      source: undefined,\n      actions: []\n    }, undefined, context !== null && context !== void 0 ? context : this.machine.context, undefined);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialState\", {\n    /**\r\n     * The initial State instance, which includes all actions to be executed from\r\n     * entering the initial state.\r\n     */\n    get: function () {\n      var initialStateValue = this.initialStateValue;\n\n      if (!initialStateValue) {\n        throw new Error(\"Cannot retrieve initial state from simple state '\".concat(this.id, \"'.\"));\n      }\n\n      return this.getInitialState(initialStateValue);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"target\", {\n    /**\r\n     * The target state value of the history state node, if it exists. This represents the\r\n     * default state value to transition to if no history value exists yet.\r\n     */\n    get: function () {\n      var target;\n\n      if (this.type === 'history') {\n        var historyConfig = this.config;\n\n        if (isString(historyConfig.target)) {\n          target = isStateId(historyConfig.target) ? pathToStateValue(this.machine.getStateNodeById(historyConfig.target).path.slice(this.path.length - 1)) : historyConfig.target;\n        } else {\n          target = historyConfig.target;\n        }\n      }\n\n      return target;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Returns the leaf nodes from a state path relative to this state node.\r\n   *\r\n   * @param relativeStateId The relative state path to retrieve the state nodes\r\n   * @param history The previous state to retrieve history\r\n   * @param resolve Whether state nodes should resolve to initial child state nodes\r\n   */\n\n  StateNode.prototype.getRelativeStateNodes = function (relativeStateId, historyValue, resolve) {\n    if (resolve === void 0) {\n      resolve = true;\n    }\n\n    return resolve ? relativeStateId.type === 'history' ? relativeStateId.resolveHistory(historyValue) : relativeStateId.initialStateNodes : [relativeStateId];\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialStateNodes\", {\n    get: function () {\n      var _this = this;\n\n      if (isLeafNode(this)) {\n        return [this];\n      } // Case when state node is compound but no initial state is defined\n\n\n      if (this.type === 'compound' && !this.initial) {\n        if (!IS_PRODUCTION) {\n          warn(false, \"Compound state node '\".concat(this.id, \"' has no initial state.\"));\n        }\n\n        return [this];\n      }\n\n      var initialStateNodePaths = toStatePaths(this.initialStateValue);\n      return flatten(initialStateNodePaths.map(function (initialPath) {\n        return _this.getFromRelativePath(initialPath);\n      }));\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Retrieves state nodes from a relative path to this state node.\r\n   *\r\n   * @param relativePath The relative path from this state node\r\n   * @param historyValue\r\n   */\n\n  StateNode.prototype.getFromRelativePath = function (relativePath) {\n    if (!relativePath.length) {\n      return [this];\n    }\n\n    var _a = __read(relativePath),\n        stateKey = _a[0],\n        childStatePath = _a.slice(1);\n\n    if (!this.states) {\n      throw new Error(\"Cannot retrieve subPath '\".concat(stateKey, \"' from node with no states\"));\n    }\n\n    var childStateNode = this.getStateNode(stateKey);\n\n    if (childStateNode.type === 'history') {\n      return childStateNode.resolveHistory();\n    }\n\n    if (!this.states[stateKey]) {\n      throw new Error(\"Child state '\".concat(stateKey, \"' does not exist on '\").concat(this.id, \"'\"));\n    }\n\n    return this.states[stateKey].getFromRelativePath(childStatePath);\n  };\n\n  StateNode.prototype.historyValue = function (relativeStateValue) {\n    if (!Object.keys(this.states).length) {\n      return undefined;\n    }\n\n    return {\n      current: relativeStateValue || this.initialStateValue,\n      states: mapFilterValues(this.states, function (stateNode, key) {\n        if (!relativeStateValue) {\n          return stateNode.historyValue();\n        }\n\n        var subStateValue = isString(relativeStateValue) ? undefined : relativeStateValue[key];\n        return stateNode.historyValue(subStateValue || stateNode.initialStateValue);\n      }, function (stateNode) {\n        return !stateNode.history;\n      })\n    };\n  };\n  /**\r\n   * Resolves to the historical value(s) of the parent state node,\r\n   * represented by state nodes.\r\n   *\r\n   * @param historyValue\r\n   */\n\n\n  StateNode.prototype.resolveHistory = function (historyValue) {\n    var _this = this;\n\n    if (this.type !== 'history') {\n      return [this];\n    }\n\n    var parent = this.parent;\n\n    if (!historyValue) {\n      var historyTarget = this.target;\n      return historyTarget ? flatten(toStatePaths(historyTarget).map(function (relativeChildPath) {\n        return parent.getFromRelativePath(relativeChildPath);\n      })) : parent.initialStateNodes;\n    }\n\n    var subHistoryValue = nestedPath(parent.path, 'states')(historyValue).current;\n\n    if (isString(subHistoryValue)) {\n      return [parent.getStateNode(subHistoryValue)];\n    }\n\n    return flatten(toStatePaths(subHistoryValue).map(function (subStatePath) {\n      return _this.history === 'deep' ? parent.getFromRelativePath(subStatePath) : [parent.states[subStatePath[0]]];\n    }));\n  };\n\n  Object.defineProperty(StateNode.prototype, \"stateIds\", {\n    /**\r\n     * All the state node IDs of this state node and its descendant state nodes.\r\n     */\n    get: function () {\n      var _this = this;\n\n      var childStateIds = flatten(Object.keys(this.states).map(function (stateKey) {\n        return _this.states[stateKey].stateIds;\n      }));\n      return [this.id].concat(childStateIds);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"events\", {\n    /**\r\n     * All the event types accepted by this state node and its descendants.\r\n     */\n    get: function () {\n      var e_8, _a, e_9, _b;\n\n      if (this.__cache.events) {\n        return this.__cache.events;\n      }\n\n      var states = this.states;\n      var events = new Set(this.ownEvents);\n\n      if (states) {\n        try {\n          for (var _c = __values(Object.keys(states)), _d = _c.next(); !_d.done; _d = _c.next()) {\n            var stateId = _d.value;\n            var state = states[stateId];\n\n            if (state.states) {\n              try {\n                for (var _e = (e_9 = void 0, __values(state.events)), _f = _e.next(); !_f.done; _f = _e.next()) {\n                  var event_1 = _f.value;\n                  events.add(\"\".concat(event_1));\n                }\n              } catch (e_9_1) {\n                e_9 = {\n                  error: e_9_1\n                };\n              } finally {\n                try {\n                  if (_f && !_f.done && (_b = _e.return)) _b.call(_e);\n                } finally {\n                  if (e_9) throw e_9.error;\n                }\n              }\n            }\n          }\n        } catch (e_8_1) {\n          e_8 = {\n            error: e_8_1\n          };\n        } finally {\n          try {\n            if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n          } finally {\n            if (e_8) throw e_8.error;\n          }\n        }\n      }\n\n      return this.__cache.events = Array.from(events);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"ownEvents\", {\n    /**\r\n     * All the events that have transitions directly from this state node.\r\n     *\r\n     * Excludes any inert events.\r\n     */\n    get: function () {\n      var events = new Set(this.transitions.filter(function (transition) {\n        return !(!transition.target && !transition.actions.length && transition.internal);\n      }).map(function (transition) {\n        return transition.eventType;\n      }));\n      return Array.from(events);\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StateNode.prototype.resolveTarget = function (_target) {\n    var _this = this;\n\n    if (_target === undefined) {\n      // an undefined target signals that the state node should not transition from that state when receiving that event\n      return undefined;\n    }\n\n    return _target.map(function (target) {\n      if (!isString(target)) {\n        return target;\n      }\n\n      var isInternalTarget = target[0] === _this.delimiter; // If internal target is defined on machine,\n      // do not include machine key on target\n\n      if (isInternalTarget && !_this.parent) {\n        return _this.getStateNodeByPath(target.slice(1));\n      }\n\n      var resolvedTarget = isInternalTarget ? _this.key + target : target;\n\n      if (_this.parent) {\n        try {\n          var targetStateNode = _this.parent.getStateNodeByPath(resolvedTarget);\n\n          return targetStateNode;\n        } catch (err) {\n          throw new Error(\"Invalid transition definition for state node '\".concat(_this.id, \"':\\n\").concat(err.message));\n        }\n      } else {\n        return _this.getStateNodeByPath(resolvedTarget);\n      }\n    });\n  };\n\n  StateNode.prototype.formatTransition = function (transitionConfig) {\n    var _this = this;\n\n    var normalizedTarget = normalizeTarget(transitionConfig.target);\n    var internal = 'internal' in transitionConfig ? transitionConfig.internal : normalizedTarget ? normalizedTarget.some(function (_target) {\n      return isString(_target) && _target[0] === _this.delimiter;\n    }) : true;\n    var guards = this.machine.options.guards;\n    var target = this.resolveTarget(normalizedTarget);\n\n    var transition = __assign(__assign({}, transitionConfig), {\n      actions: toActionObjects(toArray(transitionConfig.actions)),\n      cond: toGuard(transitionConfig.cond, guards),\n      target: target,\n      source: this,\n      internal: internal,\n      eventType: transitionConfig.event,\n      toJSON: function () {\n        return __assign(__assign({}, transition), {\n          target: transition.target ? transition.target.map(function (t) {\n            return \"#\".concat(t.id);\n          }) : undefined,\n          source: \"#\".concat(_this.id)\n        });\n      }\n    });\n\n    return transition;\n  };\n\n  StateNode.prototype.formatTransitions = function () {\n    var e_10, _a;\n\n    var _this = this;\n\n    var onConfig;\n\n    if (!this.config.on) {\n      onConfig = [];\n    } else if (Array.isArray(this.config.on)) {\n      onConfig = this.config.on;\n    } else {\n      var _b = this.config.on,\n          _c = WILDCARD,\n          _d = _b[_c],\n          wildcardConfigs = _d === void 0 ? [] : _d,\n          strictTransitionConfigs_1 = __rest(_b, [typeof _c === \"symbol\" ? _c : _c + \"\"]);\n\n      onConfig = flatten(Object.keys(strictTransitionConfigs_1).map(function (key) {\n        if (!IS_PRODUCTION && key === NULL_EVENT) {\n          warn(false, \"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. \" + \"Please check the `on` configuration for \\\"#\".concat(_this.id, \"\\\".\"));\n        }\n\n        var transitionConfigArray = toTransitionConfigArray(key, strictTransitionConfigs_1[key]);\n\n        if (!IS_PRODUCTION) {\n          validateArrayifiedTransitions(_this, key, transitionConfigArray);\n        }\n\n        return transitionConfigArray;\n      }).concat(toTransitionConfigArray(WILDCARD, wildcardConfigs)));\n    }\n\n    var eventlessConfig = this.config.always ? toTransitionConfigArray('', this.config.always) : [];\n    var doneConfig = this.config.onDone ? toTransitionConfigArray(String(done(this.id)), this.config.onDone) : [];\n\n    if (!IS_PRODUCTION) {\n      warn(!(this.config.onDone && !this.parent), \"Root nodes cannot have an \\\".onDone\\\" transition. Please check the config of \\\"\".concat(this.id, \"\\\".\"));\n    }\n\n    var invokeConfig = flatten(this.invoke.map(function (invokeDef) {\n      var settleTransitions = [];\n\n      if (invokeDef.onDone) {\n        settleTransitions.push.apply(settleTransitions, __spreadArray([], __read(toTransitionConfigArray(String(doneInvoke(invokeDef.id)), invokeDef.onDone)), false));\n      }\n\n      if (invokeDef.onError) {\n        settleTransitions.push.apply(settleTransitions, __spreadArray([], __read(toTransitionConfigArray(String(error(invokeDef.id)), invokeDef.onError)), false));\n      }\n\n      return settleTransitions;\n    }));\n    var delayedTransitions = this.after;\n    var formattedTransitions = flatten(__spreadArray(__spreadArray(__spreadArray(__spreadArray([], __read(doneConfig), false), __read(invokeConfig), false), __read(onConfig), false), __read(eventlessConfig), false).map(function (transitionConfig) {\n      return toArray(transitionConfig).map(function (transition) {\n        return _this.formatTransition(transition);\n      });\n    }));\n\n    try {\n      for (var delayedTransitions_1 = __values(delayedTransitions), delayedTransitions_1_1 = delayedTransitions_1.next(); !delayedTransitions_1_1.done; delayedTransitions_1_1 = delayedTransitions_1.next()) {\n        var delayedTransition = delayedTransitions_1_1.value;\n        formattedTransitions.push(delayedTransition);\n      }\n    } catch (e_10_1) {\n      e_10 = {\n        error: e_10_1\n      };\n    } finally {\n      try {\n        if (delayedTransitions_1_1 && !delayedTransitions_1_1.done && (_a = delayedTransitions_1.return)) _a.call(delayedTransitions_1);\n      } finally {\n        if (e_10) throw e_10.error;\n      }\n    }\n\n    return formattedTransitions;\n  };\n\n  return StateNode;\n}();\n\nexport { StateNode };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}