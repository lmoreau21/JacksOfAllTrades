{"ast":null,"code":"import { __awaiter, __generator, __values } from \"tslib\";\nimport { toHex } from \"@aws-sdk/util-hex-encoding\";\nimport { normalizeProvider } from \"@aws-sdk/util-middleware\";\nimport { ALGORITHM_IDENTIFIER, ALGORITHM_QUERY_PARAM, AMZ_DATE_HEADER, AMZ_DATE_QUERY_PARAM, AUTH_HEADER, CREDENTIAL_QUERY_PARAM, EVENT_ALGORITHM_IDENTIFIER, EXPIRES_QUERY_PARAM, MAX_PRESIGNED_TTL, SHA256_HEADER, SIGNATURE_QUERY_PARAM, SIGNED_HEADERS_QUERY_PARAM, TOKEN_HEADER, TOKEN_QUERY_PARAM } from \"./constants\";\nimport { createScope, getSigningKey } from \"./credentialDerivation\";\nimport { getCanonicalHeaders } from \"./getCanonicalHeaders\";\nimport { getCanonicalQuery } from \"./getCanonicalQuery\";\nimport { getPayloadHash } from \"./getPayloadHash\";\nimport { hasHeader } from \"./headerUtil\";\nimport { moveHeadersToQuery } from \"./moveHeadersToQuery\";\nimport { prepareRequest } from \"./prepareRequest\";\nimport { iso8601 } from \"./utilDate\";\n\nvar SignatureV4 = function () {\n  function SignatureV4(_a) {\n    var applyChecksum = _a.applyChecksum,\n        credentials = _a.credentials,\n        region = _a.region,\n        service = _a.service,\n        sha256 = _a.sha256,\n        _b = _a.uriEscapePath,\n        uriEscapePath = _b === void 0 ? true : _b;\n    this.service = service;\n    this.sha256 = sha256;\n    this.uriEscapePath = uriEscapePath;\n    this.applyChecksum = typeof applyChecksum === \"boolean\" ? applyChecksum : true;\n    this.regionProvider = normalizeProvider(region);\n    this.credentialProvider = normalizeProvider(credentials);\n  }\n\n  SignatureV4.prototype.presign = function (originalRequest, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, signingDate, _b, expiresIn, unsignableHeaders, unhoistableHeaders, signableHeaders, signingRegion, signingService, credentials, region, _c, _d, longDate, shortDate, scope, request, canonicalHeaders, _e, _f, _g, _h, _j, _k;\n\n      return __generator(this, function (_l) {\n        switch (_l.label) {\n          case 0:\n            _a = options.signingDate, signingDate = _a === void 0 ? new Date() : _a, _b = options.expiresIn, expiresIn = _b === void 0 ? 3600 : _b, unsignableHeaders = options.unsignableHeaders, unhoistableHeaders = options.unhoistableHeaders, signableHeaders = options.signableHeaders, signingRegion = options.signingRegion, signingService = options.signingService;\n            return [4, this.credentialProvider()];\n\n          case 1:\n            credentials = _l.sent();\n            this.validateResolvedCredentials(credentials);\n            if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 2];\n            _c = signingRegion;\n            return [3, 4];\n\n          case 2:\n            return [4, this.regionProvider()];\n\n          case 3:\n            _c = _l.sent();\n            _l.label = 4;\n\n          case 4:\n            region = _c;\n            _d = formatDate(signingDate), longDate = _d.longDate, shortDate = _d.shortDate;\n\n            if (expiresIn > MAX_PRESIGNED_TTL) {\n              return [2, Promise.reject(\"Signature version 4 presigned URLs\" + \" must have an expiration date less than one week in\" + \" the future\")];\n            }\n\n            scope = createScope(shortDate, region, signingService !== null && signingService !== void 0 ? signingService : this.service);\n            request = moveHeadersToQuery(prepareRequest(originalRequest), {\n              unhoistableHeaders: unhoistableHeaders\n            });\n\n            if (credentials.sessionToken) {\n              request.query[TOKEN_QUERY_PARAM] = credentials.sessionToken;\n            }\n\n            request.query[ALGORITHM_QUERY_PARAM] = ALGORITHM_IDENTIFIER;\n            request.query[CREDENTIAL_QUERY_PARAM] = \"\".concat(credentials.accessKeyId, \"/\").concat(scope);\n            request.query[AMZ_DATE_QUERY_PARAM] = longDate;\n            request.query[EXPIRES_QUERY_PARAM] = expiresIn.toString(10);\n            canonicalHeaders = getCanonicalHeaders(request, unsignableHeaders, signableHeaders);\n            request.query[SIGNED_HEADERS_QUERY_PARAM] = getCanonicalHeaderList(canonicalHeaders);\n            _e = request.query;\n            _f = SIGNATURE_QUERY_PARAM;\n            _g = this.getSignature;\n            _h = [longDate, scope, this.getSigningKey(credentials, region, shortDate, signingService)];\n            _j = this.createCanonicalRequest;\n            _k = [request, canonicalHeaders];\n            return [4, getPayloadHash(originalRequest, this.sha256)];\n\n          case 5:\n            return [4, _g.apply(this, _h.concat([_j.apply(this, _k.concat([_l.sent()]))]))];\n\n          case 6:\n            _e[_f] = _l.sent();\n            return [2, request];\n        }\n      });\n    });\n  };\n\n  SignatureV4.prototype.sign = function (toSign, options) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (typeof toSign === \"string\") {\n          return [2, this.signString(toSign, options)];\n        } else if (toSign.headers && toSign.payload) {\n          return [2, this.signEvent(toSign, options)];\n        } else {\n          return [2, this.signRequest(toSign, options)];\n        }\n\n        return [2];\n      });\n    });\n  };\n\n  SignatureV4.prototype.signEvent = function (_a, _b) {\n    var headers = _a.headers,\n        payload = _a.payload;\n    var _c = _b.signingDate,\n        signingDate = _c === void 0 ? new Date() : _c,\n        priorSignature = _b.priorSignature,\n        signingRegion = _b.signingRegion,\n        signingService = _b.signingService;\n    return __awaiter(this, void 0, void 0, function () {\n      var region, _d, _e, shortDate, longDate, scope, hashedPayload, hash, hashedHeaders, _f, stringToSign;\n\n      return __generator(this, function (_g) {\n        switch (_g.label) {\n          case 0:\n            if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 1];\n            _d = signingRegion;\n            return [3, 3];\n\n          case 1:\n            return [4, this.regionProvider()];\n\n          case 2:\n            _d = _g.sent();\n            _g.label = 3;\n\n          case 3:\n            region = _d;\n            _e = formatDate(signingDate), shortDate = _e.shortDate, longDate = _e.longDate;\n            scope = createScope(shortDate, region, signingService !== null && signingService !== void 0 ? signingService : this.service);\n            return [4, getPayloadHash({\n              headers: {},\n              body: payload\n            }, this.sha256)];\n\n          case 4:\n            hashedPayload = _g.sent();\n            hash = new this.sha256();\n            hash.update(headers);\n            _f = toHex;\n            return [4, hash.digest()];\n\n          case 5:\n            hashedHeaders = _f.apply(void 0, [_g.sent()]);\n            stringToSign = [EVENT_ALGORITHM_IDENTIFIER, longDate, scope, priorSignature, hashedHeaders, hashedPayload].join(\"\\n\");\n            return [2, this.signString(stringToSign, {\n              signingDate: signingDate,\n              signingRegion: region,\n              signingService: signingService\n            })];\n        }\n      });\n    });\n  };\n\n  SignatureV4.prototype.signString = function (stringToSign, _a) {\n    var _b = _a === void 0 ? {} : _a,\n        _c = _b.signingDate,\n        signingDate = _c === void 0 ? new Date() : _c,\n        signingRegion = _b.signingRegion,\n        signingService = _b.signingService;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var credentials, region, _d, shortDate, hash, _e, _f, _g;\n\n      return __generator(this, function (_h) {\n        switch (_h.label) {\n          case 0:\n            return [4, this.credentialProvider()];\n\n          case 1:\n            credentials = _h.sent();\n            this.validateResolvedCredentials(credentials);\n            if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 2];\n            _d = signingRegion;\n            return [3, 4];\n\n          case 2:\n            return [4, this.regionProvider()];\n\n          case 3:\n            _d = _h.sent();\n            _h.label = 4;\n\n          case 4:\n            region = _d;\n            shortDate = formatDate(signingDate).shortDate;\n            _f = (_e = this.sha256).bind;\n            return [4, this.getSigningKey(credentials, region, shortDate, signingService)];\n\n          case 5:\n            hash = new (_f.apply(_e, [void 0, _h.sent()]))();\n            hash.update(stringToSign);\n            _g = toHex;\n            return [4, hash.digest()];\n\n          case 6:\n            return [2, _g.apply(void 0, [_h.sent()])];\n        }\n      });\n    });\n  };\n\n  SignatureV4.prototype.signRequest = function (requestToSign, _a) {\n    var _b = _a === void 0 ? {} : _a,\n        _c = _b.signingDate,\n        signingDate = _c === void 0 ? new Date() : _c,\n        signableHeaders = _b.signableHeaders,\n        unsignableHeaders = _b.unsignableHeaders,\n        signingRegion = _b.signingRegion,\n        signingService = _b.signingService;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var credentials, region, _d, request, _e, longDate, shortDate, scope, payloadHash, canonicalHeaders, signature;\n\n      return __generator(this, function (_f) {\n        switch (_f.label) {\n          case 0:\n            return [4, this.credentialProvider()];\n\n          case 1:\n            credentials = _f.sent();\n            this.validateResolvedCredentials(credentials);\n            if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 2];\n            _d = signingRegion;\n            return [3, 4];\n\n          case 2:\n            return [4, this.regionProvider()];\n\n          case 3:\n            _d = _f.sent();\n            _f.label = 4;\n\n          case 4:\n            region = _d;\n            request = prepareRequest(requestToSign);\n            _e = formatDate(signingDate), longDate = _e.longDate, shortDate = _e.shortDate;\n            scope = createScope(shortDate, region, signingService !== null && signingService !== void 0 ? signingService : this.service);\n            request.headers[AMZ_DATE_HEADER] = longDate;\n\n            if (credentials.sessionToken) {\n              request.headers[TOKEN_HEADER] = credentials.sessionToken;\n            }\n\n            return [4, getPayloadHash(request, this.sha256)];\n\n          case 5:\n            payloadHash = _f.sent();\n\n            if (!hasHeader(SHA256_HEADER, request.headers) && this.applyChecksum) {\n              request.headers[SHA256_HEADER] = payloadHash;\n            }\n\n            canonicalHeaders = getCanonicalHeaders(request, unsignableHeaders, signableHeaders);\n            return [4, this.getSignature(longDate, scope, this.getSigningKey(credentials, region, shortDate, signingService), this.createCanonicalRequest(request, canonicalHeaders, payloadHash))];\n\n          case 6:\n            signature = _f.sent();\n            request.headers[AUTH_HEADER] = \"\".concat(ALGORITHM_IDENTIFIER, \" \") + \"Credential=\".concat(credentials.accessKeyId, \"/\").concat(scope, \", \") + \"SignedHeaders=\".concat(getCanonicalHeaderList(canonicalHeaders), \", \") + \"Signature=\".concat(signature);\n            return [2, request];\n        }\n      });\n    });\n  };\n\n  SignatureV4.prototype.createCanonicalRequest = function (request, canonicalHeaders, payloadHash) {\n    var sortedHeaders = Object.keys(canonicalHeaders).sort();\n    return \"\".concat(request.method, \"\\n\").concat(this.getCanonicalPath(request), \"\\n\").concat(getCanonicalQuery(request), \"\\n\").concat(sortedHeaders.map(function (name) {\n      return \"\".concat(name, \":\").concat(canonicalHeaders[name]);\n    }).join(\"\\n\"), \"\\n\\n\").concat(sortedHeaders.join(\";\"), \"\\n\").concat(payloadHash);\n  };\n\n  SignatureV4.prototype.createStringToSign = function (longDate, credentialScope, canonicalRequest) {\n    return __awaiter(this, void 0, void 0, function () {\n      var hash, hashedRequest;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            hash = new this.sha256();\n            hash.update(canonicalRequest);\n            return [4, hash.digest()];\n\n          case 1:\n            hashedRequest = _a.sent();\n            return [2, \"\".concat(ALGORITHM_IDENTIFIER, \"\\n\").concat(longDate, \"\\n\").concat(credentialScope, \"\\n\").concat(toHex(hashedRequest))];\n        }\n      });\n    });\n  };\n\n  SignatureV4.prototype.getCanonicalPath = function (_a) {\n    var e_1, _b;\n\n    var path = _a.path;\n\n    if (this.uriEscapePath) {\n      var normalizedPathSegments = [];\n\n      try {\n        for (var _c = __values(path.split(\"/\")), _d = _c.next(); !_d.done; _d = _c.next()) {\n          var pathSegment = _d.value;\n          if ((pathSegment === null || pathSegment === void 0 ? void 0 : pathSegment.length) === 0) continue;\n          if (pathSegment === \".\") continue;\n\n          if (pathSegment === \"..\") {\n            normalizedPathSegments.pop();\n          } else {\n            normalizedPathSegments.push(pathSegment);\n          }\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_d && !_d.done && (_b = _c.return)) _b.call(_c);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n\n      var normalizedPath = \"\".concat((path === null || path === void 0 ? void 0 : path.startsWith(\"/\")) ? \"/\" : \"\").concat(normalizedPathSegments.join(\"/\")).concat(normalizedPathSegments.length > 0 && (path === null || path === void 0 ? void 0 : path.endsWith(\"/\")) ? \"/\" : \"\");\n      var doubleEncoded = encodeURIComponent(normalizedPath);\n      return doubleEncoded.replace(/%2F/g, \"/\");\n    }\n\n    return path;\n  };\n\n  SignatureV4.prototype.getSignature = function (longDate, credentialScope, keyPromise, canonicalRequest) {\n    return __awaiter(this, void 0, void 0, function () {\n      var stringToSign, hash, _a, _b, _c;\n\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            return [4, this.createStringToSign(longDate, credentialScope, canonicalRequest)];\n\n          case 1:\n            stringToSign = _d.sent();\n            _b = (_a = this.sha256).bind;\n            return [4, keyPromise];\n\n          case 2:\n            hash = new (_b.apply(_a, [void 0, _d.sent()]))();\n            hash.update(stringToSign);\n            _c = toHex;\n            return [4, hash.digest()];\n\n          case 3:\n            return [2, _c.apply(void 0, [_d.sent()])];\n        }\n      });\n    });\n  };\n\n  SignatureV4.prototype.getSigningKey = function (credentials, region, shortDate, service) {\n    return getSigningKey(this.sha256, credentials, shortDate, region, service || this.service);\n  };\n\n  SignatureV4.prototype.validateResolvedCredentials = function (credentials) {\n    if (typeof credentials !== \"object\" || typeof credentials.accessKeyId !== \"string\" || typeof credentials.secretAccessKey !== \"string\") {\n      throw new Error(\"Resolved credential object is not valid\");\n    }\n  };\n\n  return SignatureV4;\n}();\n\nexport { SignatureV4 };\n\nvar formatDate = function (now) {\n  var longDate = iso8601(now).replace(/[\\-:]/g, \"\");\n  return {\n    longDate: longDate,\n    shortDate: longDate.slice(0, 8)\n  };\n};\n\nvar getCanonicalHeaderList = function (headers) {\n  return Object.keys(headers).sort().join(\";\");\n};","map":{"version":3,"names":["__awaiter","__generator","__values","toHex","normalizeProvider","ALGORITHM_IDENTIFIER","ALGORITHM_QUERY_PARAM","AMZ_DATE_HEADER","AMZ_DATE_QUERY_PARAM","AUTH_HEADER","CREDENTIAL_QUERY_PARAM","EVENT_ALGORITHM_IDENTIFIER","EXPIRES_QUERY_PARAM","MAX_PRESIGNED_TTL","SHA256_HEADER","SIGNATURE_QUERY_PARAM","SIGNED_HEADERS_QUERY_PARAM","TOKEN_HEADER","TOKEN_QUERY_PARAM","createScope","getSigningKey","getCanonicalHeaders","getCanonicalQuery","getPayloadHash","hasHeader","moveHeadersToQuery","prepareRequest","iso8601","SignatureV4","_a","applyChecksum","credentials","region","service","sha256","_b","uriEscapePath","regionProvider","credentialProvider","prototype","presign","originalRequest","options","signingDate","expiresIn","unsignableHeaders","unhoistableHeaders","signableHeaders","signingRegion","signingService","_c","_d","longDate","shortDate","scope","request","canonicalHeaders","_e","_f","_g","_h","_j","_k","_l","label","Date","sent","validateResolvedCredentials","formatDate","Promise","reject","sessionToken","query","concat","accessKeyId","toString","getCanonicalHeaderList","getSignature","createCanonicalRequest","apply","sign","toSign","signString","headers","payload","signEvent","signRequest","priorSignature","hashedPayload","hash","hashedHeaders","stringToSign","body","update","digest","join","bind","requestToSign","payloadHash","signature","sortedHeaders","Object","keys","sort","method","getCanonicalPath","map","name","createStringToSign","credentialScope","canonicalRequest","hashedRequest","e_1","path","normalizedPathSegments","split","next","done","pathSegment","value","length","pop","push","e_1_1","error","return","call","normalizedPath","startsWith","endsWith","doubleEncoded","encodeURIComponent","replace","keyPromise","secretAccessKey","Error","now","slice"],"sources":["C:/Users/lmore/OneDrive/Documents/GitHub/JacksOfAllTrades/jacksofalltrades/node_modules/@aws-sdk/client-lex-runtime-v2/node_modules/@aws-sdk/signature-v4/dist-es/SignatureV4.js"],"sourcesContent":["import { __awaiter, __generator, __values } from \"tslib\";\nimport { toHex } from \"@aws-sdk/util-hex-encoding\";\nimport { normalizeProvider } from \"@aws-sdk/util-middleware\";\nimport { ALGORITHM_IDENTIFIER, ALGORITHM_QUERY_PARAM, AMZ_DATE_HEADER, AMZ_DATE_QUERY_PARAM, AUTH_HEADER, CREDENTIAL_QUERY_PARAM, EVENT_ALGORITHM_IDENTIFIER, EXPIRES_QUERY_PARAM, MAX_PRESIGNED_TTL, SHA256_HEADER, SIGNATURE_QUERY_PARAM, SIGNED_HEADERS_QUERY_PARAM, TOKEN_HEADER, TOKEN_QUERY_PARAM, } from \"./constants\";\nimport { createScope, getSigningKey } from \"./credentialDerivation\";\nimport { getCanonicalHeaders } from \"./getCanonicalHeaders\";\nimport { getCanonicalQuery } from \"./getCanonicalQuery\";\nimport { getPayloadHash } from \"./getPayloadHash\";\nimport { hasHeader } from \"./headerUtil\";\nimport { moveHeadersToQuery } from \"./moveHeadersToQuery\";\nimport { prepareRequest } from \"./prepareRequest\";\nimport { iso8601 } from \"./utilDate\";\nvar SignatureV4 = (function () {\n    function SignatureV4(_a) {\n        var applyChecksum = _a.applyChecksum, credentials = _a.credentials, region = _a.region, service = _a.service, sha256 = _a.sha256, _b = _a.uriEscapePath, uriEscapePath = _b === void 0 ? true : _b;\n        this.service = service;\n        this.sha256 = sha256;\n        this.uriEscapePath = uriEscapePath;\n        this.applyChecksum = typeof applyChecksum === \"boolean\" ? applyChecksum : true;\n        this.regionProvider = normalizeProvider(region);\n        this.credentialProvider = normalizeProvider(credentials);\n    }\n    SignatureV4.prototype.presign = function (originalRequest, options) {\n        if (options === void 0) { options = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, signingDate, _b, expiresIn, unsignableHeaders, unhoistableHeaders, signableHeaders, signingRegion, signingService, credentials, region, _c, _d, longDate, shortDate, scope, request, canonicalHeaders, _e, _f, _g, _h, _j, _k;\n            return __generator(this, function (_l) {\n                switch (_l.label) {\n                    case 0:\n                        _a = options.signingDate, signingDate = _a === void 0 ? new Date() : _a, _b = options.expiresIn, expiresIn = _b === void 0 ? 3600 : _b, unsignableHeaders = options.unsignableHeaders, unhoistableHeaders = options.unhoistableHeaders, signableHeaders = options.signableHeaders, signingRegion = options.signingRegion, signingService = options.signingService;\n                        return [4, this.credentialProvider()];\n                    case 1:\n                        credentials = _l.sent();\n                        this.validateResolvedCredentials(credentials);\n                        if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 2];\n                        _c = signingRegion;\n                        return [3, 4];\n                    case 2: return [4, this.regionProvider()];\n                    case 3:\n                        _c = (_l.sent());\n                        _l.label = 4;\n                    case 4:\n                        region = _c;\n                        _d = formatDate(signingDate), longDate = _d.longDate, shortDate = _d.shortDate;\n                        if (expiresIn > MAX_PRESIGNED_TTL) {\n                            return [2, Promise.reject(\"Signature version 4 presigned URLs\" + \" must have an expiration date less than one week in\" + \" the future\")];\n                        }\n                        scope = createScope(shortDate, region, signingService !== null && signingService !== void 0 ? signingService : this.service);\n                        request = moveHeadersToQuery(prepareRequest(originalRequest), { unhoistableHeaders: unhoistableHeaders });\n                        if (credentials.sessionToken) {\n                            request.query[TOKEN_QUERY_PARAM] = credentials.sessionToken;\n                        }\n                        request.query[ALGORITHM_QUERY_PARAM] = ALGORITHM_IDENTIFIER;\n                        request.query[CREDENTIAL_QUERY_PARAM] = \"\".concat(credentials.accessKeyId, \"/\").concat(scope);\n                        request.query[AMZ_DATE_QUERY_PARAM] = longDate;\n                        request.query[EXPIRES_QUERY_PARAM] = expiresIn.toString(10);\n                        canonicalHeaders = getCanonicalHeaders(request, unsignableHeaders, signableHeaders);\n                        request.query[SIGNED_HEADERS_QUERY_PARAM] = getCanonicalHeaderList(canonicalHeaders);\n                        _e = request.query;\n                        _f = SIGNATURE_QUERY_PARAM;\n                        _g = this.getSignature;\n                        _h = [longDate,\n                            scope,\n                            this.getSigningKey(credentials, region, shortDate, signingService)];\n                        _j = this.createCanonicalRequest;\n                        _k = [request, canonicalHeaders];\n                        return [4, getPayloadHash(originalRequest, this.sha256)];\n                    case 5: return [4, _g.apply(this, _h.concat([_j.apply(this, _k.concat([_l.sent()]))]))];\n                    case 6:\n                        _e[_f] = _l.sent();\n                        return [2, request];\n                }\n            });\n        });\n    };\n    SignatureV4.prototype.sign = function (toSign, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (typeof toSign === \"string\") {\n                    return [2, this.signString(toSign, options)];\n                }\n                else if (toSign.headers && toSign.payload) {\n                    return [2, this.signEvent(toSign, options)];\n                }\n                else {\n                    return [2, this.signRequest(toSign, options)];\n                }\n                return [2];\n            });\n        });\n    };\n    SignatureV4.prototype.signEvent = function (_a, _b) {\n        var headers = _a.headers, payload = _a.payload;\n        var _c = _b.signingDate, signingDate = _c === void 0 ? new Date() : _c, priorSignature = _b.priorSignature, signingRegion = _b.signingRegion, signingService = _b.signingService;\n        return __awaiter(this, void 0, void 0, function () {\n            var region, _d, _e, shortDate, longDate, scope, hashedPayload, hash, hashedHeaders, _f, stringToSign;\n            return __generator(this, function (_g) {\n                switch (_g.label) {\n                    case 0:\n                        if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 1];\n                        _d = signingRegion;\n                        return [3, 3];\n                    case 1: return [4, this.regionProvider()];\n                    case 2:\n                        _d = (_g.sent());\n                        _g.label = 3;\n                    case 3:\n                        region = _d;\n                        _e = formatDate(signingDate), shortDate = _e.shortDate, longDate = _e.longDate;\n                        scope = createScope(shortDate, region, signingService !== null && signingService !== void 0 ? signingService : this.service);\n                        return [4, getPayloadHash({ headers: {}, body: payload }, this.sha256)];\n                    case 4:\n                        hashedPayload = _g.sent();\n                        hash = new this.sha256();\n                        hash.update(headers);\n                        _f = toHex;\n                        return [4, hash.digest()];\n                    case 5:\n                        hashedHeaders = _f.apply(void 0, [_g.sent()]);\n                        stringToSign = [\n                            EVENT_ALGORITHM_IDENTIFIER,\n                            longDate,\n                            scope,\n                            priorSignature,\n                            hashedHeaders,\n                            hashedPayload,\n                        ].join(\"\\n\");\n                        return [2, this.signString(stringToSign, { signingDate: signingDate, signingRegion: region, signingService: signingService })];\n                }\n            });\n        });\n    };\n    SignatureV4.prototype.signString = function (stringToSign, _a) {\n        var _b = _a === void 0 ? {} : _a, _c = _b.signingDate, signingDate = _c === void 0 ? new Date() : _c, signingRegion = _b.signingRegion, signingService = _b.signingService;\n        return __awaiter(this, void 0, void 0, function () {\n            var credentials, region, _d, shortDate, hash, _e, _f, _g;\n            return __generator(this, function (_h) {\n                switch (_h.label) {\n                    case 0: return [4, this.credentialProvider()];\n                    case 1:\n                        credentials = _h.sent();\n                        this.validateResolvedCredentials(credentials);\n                        if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 2];\n                        _d = signingRegion;\n                        return [3, 4];\n                    case 2: return [4, this.regionProvider()];\n                    case 3:\n                        _d = (_h.sent());\n                        _h.label = 4;\n                    case 4:\n                        region = _d;\n                        shortDate = formatDate(signingDate).shortDate;\n                        _f = (_e = this.sha256).bind;\n                        return [4, this.getSigningKey(credentials, region, shortDate, signingService)];\n                    case 5:\n                        hash = new (_f.apply(_e, [void 0, _h.sent()]))();\n                        hash.update(stringToSign);\n                        _g = toHex;\n                        return [4, hash.digest()];\n                    case 6: return [2, _g.apply(void 0, [_h.sent()])];\n                }\n            });\n        });\n    };\n    SignatureV4.prototype.signRequest = function (requestToSign, _a) {\n        var _b = _a === void 0 ? {} : _a, _c = _b.signingDate, signingDate = _c === void 0 ? new Date() : _c, signableHeaders = _b.signableHeaders, unsignableHeaders = _b.unsignableHeaders, signingRegion = _b.signingRegion, signingService = _b.signingService;\n        return __awaiter(this, void 0, void 0, function () {\n            var credentials, region, _d, request, _e, longDate, shortDate, scope, payloadHash, canonicalHeaders, signature;\n            return __generator(this, function (_f) {\n                switch (_f.label) {\n                    case 0: return [4, this.credentialProvider()];\n                    case 1:\n                        credentials = _f.sent();\n                        this.validateResolvedCredentials(credentials);\n                        if (!(signingRegion !== null && signingRegion !== void 0)) return [3, 2];\n                        _d = signingRegion;\n                        return [3, 4];\n                    case 2: return [4, this.regionProvider()];\n                    case 3:\n                        _d = (_f.sent());\n                        _f.label = 4;\n                    case 4:\n                        region = _d;\n                        request = prepareRequest(requestToSign);\n                        _e = formatDate(signingDate), longDate = _e.longDate, shortDate = _e.shortDate;\n                        scope = createScope(shortDate, region, signingService !== null && signingService !== void 0 ? signingService : this.service);\n                        request.headers[AMZ_DATE_HEADER] = longDate;\n                        if (credentials.sessionToken) {\n                            request.headers[TOKEN_HEADER] = credentials.sessionToken;\n                        }\n                        return [4, getPayloadHash(request, this.sha256)];\n                    case 5:\n                        payloadHash = _f.sent();\n                        if (!hasHeader(SHA256_HEADER, request.headers) && this.applyChecksum) {\n                            request.headers[SHA256_HEADER] = payloadHash;\n                        }\n                        canonicalHeaders = getCanonicalHeaders(request, unsignableHeaders, signableHeaders);\n                        return [4, this.getSignature(longDate, scope, this.getSigningKey(credentials, region, shortDate, signingService), this.createCanonicalRequest(request, canonicalHeaders, payloadHash))];\n                    case 6:\n                        signature = _f.sent();\n                        request.headers[AUTH_HEADER] =\n                            \"\".concat(ALGORITHM_IDENTIFIER, \" \") +\n                                \"Credential=\".concat(credentials.accessKeyId, \"/\").concat(scope, \", \") +\n                                \"SignedHeaders=\".concat(getCanonicalHeaderList(canonicalHeaders), \", \") +\n                                \"Signature=\".concat(signature);\n                        return [2, request];\n                }\n            });\n        });\n    };\n    SignatureV4.prototype.createCanonicalRequest = function (request, canonicalHeaders, payloadHash) {\n        var sortedHeaders = Object.keys(canonicalHeaders).sort();\n        return \"\".concat(request.method, \"\\n\").concat(this.getCanonicalPath(request), \"\\n\").concat(getCanonicalQuery(request), \"\\n\").concat(sortedHeaders.map(function (name) { return \"\".concat(name, \":\").concat(canonicalHeaders[name]); }).join(\"\\n\"), \"\\n\\n\").concat(sortedHeaders.join(\";\"), \"\\n\").concat(payloadHash);\n    };\n    SignatureV4.prototype.createStringToSign = function (longDate, credentialScope, canonicalRequest) {\n        return __awaiter(this, void 0, void 0, function () {\n            var hash, hashedRequest;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        hash = new this.sha256();\n                        hash.update(canonicalRequest);\n                        return [4, hash.digest()];\n                    case 1:\n                        hashedRequest = _a.sent();\n                        return [2, \"\".concat(ALGORITHM_IDENTIFIER, \"\\n\").concat(longDate, \"\\n\").concat(credentialScope, \"\\n\").concat(toHex(hashedRequest))];\n                }\n            });\n        });\n    };\n    SignatureV4.prototype.getCanonicalPath = function (_a) {\n        var e_1, _b;\n        var path = _a.path;\n        if (this.uriEscapePath) {\n            var normalizedPathSegments = [];\n            try {\n                for (var _c = __values(path.split(\"/\")), _d = _c.next(); !_d.done; _d = _c.next()) {\n                    var pathSegment = _d.value;\n                    if ((pathSegment === null || pathSegment === void 0 ? void 0 : pathSegment.length) === 0)\n                        continue;\n                    if (pathSegment === \".\")\n                        continue;\n                    if (pathSegment === \"..\") {\n                        normalizedPathSegments.pop();\n                    }\n                    else {\n                        normalizedPathSegments.push(pathSegment);\n                    }\n                }\n            }\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\n            finally {\n                try {\n                    if (_d && !_d.done && (_b = _c.return)) _b.call(_c);\n                }\n                finally { if (e_1) throw e_1.error; }\n            }\n            var normalizedPath = \"\".concat((path === null || path === void 0 ? void 0 : path.startsWith(\"/\")) ? \"/\" : \"\").concat(normalizedPathSegments.join(\"/\")).concat(normalizedPathSegments.length > 0 && (path === null || path === void 0 ? void 0 : path.endsWith(\"/\")) ? \"/\" : \"\");\n            var doubleEncoded = encodeURIComponent(normalizedPath);\n            return doubleEncoded.replace(/%2F/g, \"/\");\n        }\n        return path;\n    };\n    SignatureV4.prototype.getSignature = function (longDate, credentialScope, keyPromise, canonicalRequest) {\n        return __awaiter(this, void 0, void 0, function () {\n            var stringToSign, hash, _a, _b, _c;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0: return [4, this.createStringToSign(longDate, credentialScope, canonicalRequest)];\n                    case 1:\n                        stringToSign = _d.sent();\n                        _b = (_a = this.sha256).bind;\n                        return [4, keyPromise];\n                    case 2:\n                        hash = new (_b.apply(_a, [void 0, _d.sent()]))();\n                        hash.update(stringToSign);\n                        _c = toHex;\n                        return [4, hash.digest()];\n                    case 3: return [2, _c.apply(void 0, [_d.sent()])];\n                }\n            });\n        });\n    };\n    SignatureV4.prototype.getSigningKey = function (credentials, region, shortDate, service) {\n        return getSigningKey(this.sha256, credentials, shortDate, region, service || this.service);\n    };\n    SignatureV4.prototype.validateResolvedCredentials = function (credentials) {\n        if (typeof credentials !== \"object\" ||\n            typeof credentials.accessKeyId !== \"string\" ||\n            typeof credentials.secretAccessKey !== \"string\") {\n            throw new Error(\"Resolved credential object is not valid\");\n        }\n    };\n    return SignatureV4;\n}());\nexport { SignatureV4 };\nvar formatDate = function (now) {\n    var longDate = iso8601(now).replace(/[\\-:]/g, \"\");\n    return {\n        longDate: longDate,\n        shortDate: longDate.slice(0, 8),\n    };\n};\nvar getCanonicalHeaderList = function (headers) { return Object.keys(headers).sort().join(\";\"); };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}