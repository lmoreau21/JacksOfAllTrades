import{__awaiter as e}from"tslib";import t from"qrcode";import*as o from"react";import{Logger as r,Auth as a}from"aws-amplify";import{translate as i,getActorState as n,getTotpCode as l}from"@aws-amplify/ui";import{Flex as m}from"../../../primitives/Flex/Flex.js";import{Heading as s}from"../../../primitives/Heading/Heading.js";import{useAuthenticator as c}from"../hooks/useAuthenticator/index.js";import{useCustomComponents as d}from"../hooks/useCustomComponents/index.js";import{useFormHandlers as u}from"../hooks/useFormHandlers/useFormHandlers.js";import{ConfirmSignInFooter as p}from"../shared/ConfirmSignInFooter.js";import{RemoteErrorMessage as f}from"../shared/RemoteErrorMessage.js";import{FormFields as h}from"../shared/FormFields.js";import{RouteContainer as v}from"../RouteContainer/RouteContainer.js";const E=new r("SetupTOTP-logger"),g=({className:r,variation:s})=>{var C,y;const{_state:H,isPending:w}=c((e=>[e.isPending])),{handleChange:F,handleSubmit:S}=u(),{components:{SetupTOTP:{Header:T=g.Header,Footer:j=g.Footer}}}=d(),[x,P]=o.useState(!0),[O,V]=o.useState(),[b,k]=o.useState("COPY"),[R,L]=o.useState(""),M=n(H),{formFields:q,user:D}=M.context,{totpIssuer:I="AWSCognito",totpUsername:Z=(null==D?void 0:D.username)}=null!==(y=null===(C=null==q?void 0:q.setupTOTP)||void 0===C?void 0:C.QR)&&void 0!==y?y:{},A=o.useCallback((o=>e(void 0,void 0,void 0,(function*(){try{const e=yield a.setupTOTP(o);L(e);const r=l(I,Z,e),i=yield t.toDataURL(r);V(i)}catch(e){E.error(e)}finally{P(!1)}}))),[I,Z]);o.useEffect((()=>{D&&A(D)}),[A,D]);return o.createElement(v,{className:r,variation:s},o.createElement("form",{"data-amplify-form":"","data-amplify-authenticator-setup-totp":"",method:"post",onChange:F,onSubmit:S},o.createElement(m,{as:"fieldset",direction:"column",isDisabled:w},o.createElement(T,null),o.createElement(m,{direction:"column"},x?o.createElement("p",null,i("Loading"),"â€¦"):o.createElement("img",{"data-amplify-qrcode":!0,src:O,alt:"qr code",width:"228",height:"228"}),o.createElement(m,{"data-amplify-copy":!0},o.createElement("div",null,R),o.createElement(m,{"data-amplify-copy-svg":!0,onClick:()=>{navigator.clipboard.writeText(R),k(i("COPIED"))}},o.createElement("div",{"data-amplify-copy-tooltip":!0},b),o.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},o.createElement("path",{d:"M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM15 5H8C6.9 5 6.01 5.9 6.01 7L6 21C6 22.1 6.89 23 7.99 23H19C20.1 23 21 22.1 21 21V11L15 5ZM8 21V7H14V12H19V21H8Z"})))),o.createElement(h,null),o.createElement(f,null)),o.createElement(p,null),o.createElement(j,null))))};g.Header=function(){return o.createElement(s,{level:3},i("Setup TOTP"))},g.Footer=function(){return null};export{g as SetupTOTP};
